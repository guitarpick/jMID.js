/**
 * jMID.Track.min.js v0.2
 *
 * A javascript library for reading, manipulating, writing, and timing MIDI files
 * @author Steven Sojka - Tuesday, February 05, 2013
 *
 * MIT Licensed
 */
var jMID=function(e){var g=function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=c.length,f;d&&this[a].length;)for(b=c[--d];-1!==(f=this[a].indexOf(b));)this[a].splice(f,1);return this};e.Track=function(a){this.events=[];this.notes=[];this.timing={MicroSPB:5E5,MSPQN:500,MSPT:500/960};for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.processNotes()};e.Track.prototype={pushEvent:function(a){this.events.push(a);return this},pushNote:function(a){this.notes.push(a);return this},getEvents:function(a){return"undefined"!==
typeof a?0<=a&&a<this.events.length?this.events[a]:null:this.events},getNotes:function(a){return"undefined"!==typeof a?0<=a&&a<this.notes.length?this.notes[a]:null:this.notes},removeEvents:function(){return g.apply(this,["events"].concat(Array.prototype.slice.call(arguments)))},removeNotes:function(){return g.apply(this,["notes"].concat(Array.prototype.slice.call(arguments)))},removeNote:function(a){g.call(this,"notes",a)},removeEvent:function(a){var b=this.events.indexOf(a),b=this.events[b];g.call(this,
"events",a);b&&this.calculateDelta(b)},cloneEvents:function(){return this.events.slice(0)},cloneNotes:function(){return this.notes.slice(0)},hasEvent:function(a){return-1!==this.events.indexOf(a)},hasNote:function(){return-1!==this.notes.indexOf(notes)},insertEventAtTime:function(a){var b=this.positionEvent(a);this.events[b+1]?this.calculateDelta(a,this.events[b+1]):this.calculateDelta(a)},insertNoteAtTime:function(a){this.positionNote(a)},encode:function(){for(var a=[],b=0,c=0,d=this.events.length;c<
d;c++){var f=this.getEvents(c).encode(),b=b+f.length;Array.prototype.push.apply(a,f)}b=e.Util.stringToBytes(b.toString(16),4);return e.Util.bytesToString([77,84,114,107].concat(b,a))},adjustEventTime:function(a,b){var a=e.Util.isNumber(a)?this.events[a]:a,c=this.events.indexOf(a),d=this.events[c+1];Math.round(b/this.timing.MSPT);a.time+=b;this.hasEvent(a)&&this.events.splice(c,1);c=this.positionEvent(a);this.calculateDelta(d,a,this.events[c+1])},positionEvent:function(a){if(0===this.events.length)return this.events.splice(0,
0,a),0;for(var b=0,c=this.events.length;b<c&&a.time>this.events[b].time;b++);this.events.splice(b,0,a);return b},positionNote:function(a){var b=this.notes.indexOf(a);-1!==b&&this.notes.splice(b,1);if(0===this.notes.length)return this.notes.splice(0,0,a),0;for(var b=0,c=this.notes.length;b<c&&a.start>this.notes[b].start;b++);this.notes.splice(b,0,a);return b},calculateDelta:function(){for(var a=Array.prototype.slice.call(arguments),b=0,c=a.length;b<c;b++){var d=a[b];if(d){var f=this.events.indexOf(d),
f=this.events[f-1];d.deltaTime=f?Math.round((d.time-f.time)/this.timing.MSPT):Math.round(d.time/this.timing.MSPT)}}},switchEvents:function(a,b){var c=this.events.indexOf(a),d=this.events.indexOf(b);this.events.splice(d,1,a);this.events.splice(c,1,b)},processNotes:function(){var a={};this.notes=[];for(var b=0,c=this.events.length;b<c;b++){var d=this.events[b];"noteOn"===d.subtype?a[d.noteNumber]=d:"noteOff"===d.subtype&&d.noteNumber in a&&(new e.Note({noteOn:a[d.noteNumber],noteOff:d,track:this}),
delete a[d.noteNumber])}},processChannelEventTimes:function(){for(var a=this.timing.MSPT,b=0,c=0,d=this.events.length;c<d;c++){var f=this.events[c],e=f.deltaTime*a;f.set("time",b+e);b+=e}}};e.Emitter&&e.Emitter.register(e.Track);return e}(jMID||{});
