/**
 * jMID.Track.min.js v0.2.1
 *
 * A javascript library for reading, manipulating, writing, and timing MIDI files
 * @author Steven Sojka - Thursday, March 07, 2013
 *
 * MIT Licensed
 */
var jMID=function(f){var g=function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=c.length,e;d&&this[a].length;)for(b=c[--d];-1!==(e=this[a].indexOf(b));)this[a].splice(e,1);return this};f.Track=function(a){this.events=[];this.notes=[];this.timing={MicroSPB:5E5,MSPQN:500,MSPT:500/960};for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.processNotes()};f.Track.prototype={pushEvent:function(a){this.events.push(a);return this},pushNote:function(a){this.notes.push(a);return this},getEvents:function(a){return"undefined"!==
typeof a?0<=a&&a<this.events.length?this.events[a]:null:this.events},getNotes:function(a){return"undefined"!==typeof a?0<=a&&a<this.notes.length?this.notes[a]:null:this.notes},removeEvents:function(){return g.apply(this,["events"].concat(Array.prototype.slice.call(arguments)))},removeNotes:function(){return g.apply(this,["notes"].concat(Array.prototype.slice.call(arguments)))},removeNote:function(a){g.call(this,"notes",a)},removeEvent:function(a){var b=this.events.indexOf(a),b=this.events[b];g.call(this,
"events",a);b&&this.calculateDelta(b)},cloneEvents:function(){return this.events.slice(0)},cloneNotes:function(){return this.notes.slice(0)},hasEvent:function(a){return-1!==this.events.indexOf(a)},hasNote:function(){return-1!==this.notes.indexOf(notes)},insertEventAtTime:function(a){var b=this.positionEvent(a);this.events[b+1]?this.calculateDelta(a,this.events[b+1]):this.calculateDelta(a)},insertNoteAtTime:function(a){this.positionNote(a)},encode:function(){for(var a=[],b=0,c=0,d=this.events.length;c<
d;c++){var e=this.getEvents(c).encode(),b=b+e.length;Array.prototype.push.apply(a,e)}b=f.Util.stringToBytes(b.toString(16),4);return f.Util.bytesToString([77,84,114,107].concat(b,a))},adjustEventTime:function(a,b){var a=f.Util.isNumber(a)?this.events[a]:a,c=this.events.indexOf(a),d=this.events[c+1];Math.round(b/this.timing.MSPT);a.time+=b;this.hasEvent(a)&&this.events.splice(c,1);c=this.positionEvent(a);this.calculateDelta(d,a,this.events[c+1])},positionEvent:function(a){if(0===this.events.length)return this.events.splice(0,
0,a),0;for(var b=0,c=this.events.length;b<c&&a.time>this.events[b].time;b++);this.events.splice(b,0,a);return b},positionNote:function(a){var b=this.notes.indexOf(a);-1!==b&&this.notes.splice(b,1);if(0===this.notes.length)return this.notes.splice(0,0,a),0;for(var b=0,c=this.notes.length;b<c&&a.start>this.notes[b].start;b++);this.notes.splice(b,0,a);return b},calculateDelta:function(){for(var a=Array.prototype.slice.call(arguments),b=0,c=a.length;b<c;b++){var d=a[b];if(d){var e=this.events.indexOf(d),
e=this.events[e-1];d.deltaTime=e?Math.round((d.time-e.time)/this.timing.MSPT):Math.round(d.time/this.timing.MSPT)}}},switchEvents:function(a,b){var c=this.events.indexOf(a),d=this.events.indexOf(b);this.events.splice(d,1,a);this.events.splice(c,1,b)},processNotes:function(){var a={};this.notes=[];for(var b=0,c=this.events.length;b<c;b++){var d=this.events[b];"noteOn"===d.subtype?a[d.noteNumber]=d:"noteOff"===d.subtype&&d.noteNumber in a&&(new f.Note({noteOn:a[d.noteNumber],noteOff:d,track:this}),
delete a[d.noteNumber])}},processChannelEventTimes:function(){for(var a=this.timing.MSPT,b=0,c=0,d=this.events.length;c<d;c++){var e=this.events[c],f=e.deltaTime*a;e.set("time",b+f);"endOfTrack"===e.subtype&&(this.duration=e.get("time"));b+=f}}};f.Emitter&&f.Emitter.register(f.Track);return f}(jMID||{});
