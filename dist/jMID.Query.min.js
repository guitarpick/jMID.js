/**
 * jMID.Query.min.js v0.1
 *
 * A javascript library for reading, manipulating, and writing MIDI files
 * @author Steven Sojka - Thursday, January 31, 2013
 *
 * MIT Licensed
 */
var jMID=function(f){var m=function(a){var b;if(a){b=a.split(",").map(function(a){return a.trim()});for(var c=[],d=0,o=b.length;d<o;d++)c.push(b[d].split(" "));b=c}else b=void 0;c=[];d=0;for(o=this._results.tracks.length;d<o;d++){var i=this._results.tracks[d];c.push(new f.Track({timing:i.timing}));var h=this.noteSearch?i.getNotes():i.getEvents();if(a)for(var e=0,h=h.length;e<h;e++)for(var k=this.noteSearch?i.getNotes(e):i.getEvents(e),l=!0,m=0,r=b.length;m<r;m++){for(var q=b[m],p=0,s=q.length;p<s;p++){var n;
a:{n=q[p];for(var j=[":",">",">=","<","<="],g=j.length-1;0<=g;g--)if(-1!==n.search(j[g])){n=j[g];break a}n=void 0}g=q[p].split(n);j=g[0];g=g[1];switch(n){case ":":l=k[j]==g;break;case ">":l=k[j]>g;break;case ">=":l=k[j]>=g;break;case "<":l=k[j]<g;break;case "<=":l=k[j]<=g}if(!l)break}l&&(this.noteSearch?c[d].pushNote(k):c[d].pushEvent(k))}else c[d]=i}return{tracks:c}},e=function(a,b,c){this.noteSearch=c;this._results=b?b:{tracks:a.tracks.slice(0)};this._file=a};e.prototype={filter:function(a){a=m.call(this,
a);return new e(this._file,a,this.noteSearch)},not:function(a){for(var a=m.call(this,a),b=this._results,c=[],d=0,o=b.tracks.length;d<o;d++){var i=b.tracks[d],h=new f.Track;this.noteSearch?(h.notes=i.cloneNotes(),h.removeNotes.apply(h,a.tracks[d].getNotes())):(h.events=i.cloneEvents(),h.removeEvents.apply(h,a.tracks[d].getEvents()));c.push(h)}return new e(this._file,{tracks:c},this.noteSearch)},toArray:function(){for(var a=[],b=0,c=this._results.tracks.length;b<c;b++)var d=this._results.tracks[b],
a=a.concat(this.noteSearch?d.notes:d.events);return a},increment:function(a,b){f.Util[this.noteSearch?"forAllNotes":"forAllEvents"](this._results.tracks,function(c){a in c&&(c[a]+=b)});return this},set:function(a,b){f.Util[this.noteSearch?"forAllNotes":"forAllEvents"](this._results.tracks,function(c){a in c&&(c[a]=b)});return this},get:function(a,b){return this._results.tracks[a].events[b]},eq:function(a,b){return new e(this._file,{tracks:[new f.Track({events:[this.get.apply(this,arguments)],timing:a.timing})]})},
encodeEvents:function(a){var b=[];f.Util.forAllEvents(this._results.tracks,function(c,d,e){b[e]||(b[e]=[]);b[e].push(!a?f.Util.bytesToString(c.encode()):c.encode())});return b},encodeTracks:function(a){var b=[];f.Util.forEachTrack(this._results.tracks,function(c,d){b[d]||(b[d]=[]);b[d].push(!a?c.encode():f.Util.stringToBytes(c.encode()))});return b},notes:function(a){this.noteSearch=!0;a=m.call(this,a);return new e(this._file,a,!0)},adjustTime:function(a){if(!this.noteSearch)return this;f.Util.forAllNotes(this._results.tracks,
function(b){b.adjustTime(a)});return this},adjustNoteNumber:function(a){if(!this.noteSearch)return this;f.Util.forAllNotes(this._results.tracks,function(b){b.adjustNoteNumber(a)});return this},apply:function(){if(this.noteSearch)return this;for(var a=0,b=this._results.tracks.length;a<b;a++)this._file.tracks[a]=new f.Track({events:this._results.tracks[a].cloneEvents(),timing:this._file.tracks[a].timing});return new e(this._file)}};f.Query=function(a){if(!a&&!a instanceof f.File)throw Error("jMID.File is needed for querying");
return new e(a)};return f}(jMID||{});
