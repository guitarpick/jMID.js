/**
 * jMID.Query.min.js v0.2.1
 *
 * A javascript library for reading, manipulating, writing, and timing MIDI files
 * @author Steven Sojka - Friday, February 15, 2013
 *
 * MIT Licensed
 */
var jMID=function(e){var m=function(a){var b;if(a){b=a.split(",").map(function(a){return a.trim()});for(var c=[],d=0,f=b.length;d<f;d++)c.push(b[d].split(" "));b=c}else b=void 0;c=[];d=0;for(f=this._results.tracks.length;d<f;d++){var i=this._results.tracks[d];c.push(new e.Track({timing:i.timing}));var h=this.noteSearch?i.getNotes():i.getEvents();if(a)for(var p=0,h=h.length;p<h;p++)for(var k=this.noteSearch?i.getNotes(p):i.getEvents(p),l=!0,m=0,n=b.length;m<n;m++){for(var s=b[m],q=0,r=s.length;q<r;q++){var o;
a:{o=s[q];for(var j=[":",">",">=","<","<="],g=j.length-1;0<=g;g--)if(-1!==o.search(j[g])){o=j[g];break a}o=void 0}g=s[q].split(o);j=g[0];g=g[1];switch(o){case ":":l=k[j]==g;break;case ">":l=k[j]>g;break;case ">=":l=k[j]>=g;break;case "<":l=k[j]<g;break;case "<=":l=k[j]<=g}if(!l)break}l&&(this.noteSearch?c[d].pushNote(k):c[d].pushEvent(k))}else c[d]=i}return{tracks:c}},f=function(a,b,c){this.noteSearch=c;this._results=b?b:{tracks:a.tracks.slice(0)};this._file=a};f.prototype={filter:function(a){a=m.call(this,
a);return new f(this._file,a,this.noteSearch)},not:function(a){for(var a=m.call(this,a),b=this._results,c=[],d=0,n=b.tracks.length;d<n;d++){var i=b.tracks[d],h=new e.Track;this.noteSearch?(h.notes=i.cloneNotes(),h.removeNotes.apply(h,a.tracks[d].getNotes())):(h.events=i.cloneEvents(),h.removeEvents.apply(h,a.tracks[d].getEvents()));c.push(h)}return new f(this._file,{tracks:c},this.noteSearch)},toArray:function(){for(var a=[],b=0,c=this._results.tracks.length;b<c;b++)var d=this._results.tracks[b],
a=a.concat(this.noteSearch?d.notes:d.events);return a},increment:function(a,b){e.Util[this.noteSearch?"forAllNotes":"forAllEvents"](this._results.tracks,function(c){a in c&&(c[a]+=b)});return this},set:function(a,b){e.Util[this.noteSearch?"forAllNotes":"forAllEvents"](this._results.tracks,function(c){a in c&&(c[a]=b)});return this},get:function(a,b){return this._results.tracks[a].events[b]},eq:function(a,b){return new f(this._file,{tracks:[new e.Track({events:[this.get.apply(this,arguments)],timing:a.timing})]})},
encodeEvents:function(a){var b=[];e.Util.forAllEvents(this._results.tracks,function(c,d,f){b[f]||(b[f]=[]);b[f].push(!a?e.Util.bytesToString(c.encode()):c.encode())});return b},encodeTracks:function(a){var b=[];e.Util.forEachTrack(this._results.tracks,function(c,d){b[d]||(b[d]=[]);b[d].push(!a?c.encode():e.Util.stringToBytes(c.encode()))});return b},notes:function(a){this.noteSearch=!0;a=m.call(this,a);return new f(this._file,a,!0)},remove:function(){e.Util[this.noteSearch?"forAllNotes":"forAllEvents"](this._results.tracks,
function(a){a.remove()});return new f(this._file,{tracks:this._file.tracks.slice(0)},this.noteSearch)},apply:function(){if(this.noteSearch)return this;for(var a=0,b=this._results.tracks.length;a<b;a++)this._file.tracks[a]=new e.Track({events:this._results.tracks[a].cloneEvents(),timing:this._file.tracks[a].timing});return new f(this._file)}};for(var r="adjustNoteNumber adjustTime adjustLength setNoteNumber setVelocity setChannel".split(" "),n=0,t=r.length;n<t;n++)(function(a){f.prototype[a]=function(b){if(!this.noteSearch)return this;
e.Util.forAllNotes(this._results.tracks,function(c){c[a](b)});return this}})(r[n]);e.Query=function(a){if(!a&&!a instanceof e.File)throw Error("jMID.File is needed for querying");return new f(a)};e.Emitter&&e.Emitter.register(e.Query);return e}(jMID||{});
