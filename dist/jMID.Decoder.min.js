var jMID=function(h){var j=function(b){var a=new h.Event;a.set("deltaTime",b.readVarInt());var c=b.readInt8(),d=h.EventTypes;if(240==(c&240))switch(c){case d.META:a.set("type","meta");var e=b.readInt8(),c=b.readVarInt(),d=h.SubEventTypes,f;for(f in d){var g=d[f];if(e==g){switch(g){case d.SEQUENCE_NUMBER:a.set("number",b.readInt16());break;case d.MIDI_CHANNEL_PREFIX:a.set("channel",b.readInt8());break;case d.SET_TEMPO:a.set("microsecondsPerBeat",(b.readInt8()<<16)+(b.readInt8()<<8)+b.readInt8());a.set("subtype",
"setTempo");break;case d.SMPTE_OFFSET:e=b.readInt8();a.set({hourByte:e,frameRate:{"0":24,32:25,64:29,96:30}[e&96],hour:e&31,min:b.readInt8(),sec:b.readInt8(),frame:b.readInt8(),subframe:b.readInt8(),subtype:"smpteOffset"});break;case d.TIME_SIGNATURE:a.set({numerator:b.readInt8(),denominator:Math.pow(2,b.readInt8()),metronome:b.readInt8(),thirtyseconds:b.readInt8(),subtype:"timeSignature"});break;case d.KEY_SIGNATURE:a.set({key:b.readInt8(!0),scale:b.readInt8(),subtype:"keySignature"});break;case d.TEXT:a.set({subtype:"text",
text:b.read(c)});break;case d.COPYRIGHT_NOTICE:a.set({subtype:"copyrightNotice",text:b.read(c)});break;case d.TRACK_NAME:a.set({subtype:"trackName",text:b.read(c)});break;case d.INSTRUMENT_NAME:a.set({subtype:"instrumentName",text:b.read(c)});break;case d.LYRICS:a.set({subtype:"lyrics",text:b.read(c)});break;case d.MARKER:a.set({subtype:"marker",text:b.read(c)});break;case d.CUE_POINT:a.set({subtype:"cuePoint",text:b.read(c)});break;case d.END_OF_TRACK:a.set("subtype","endOfTrack");break;case d.SEQUENCER_SPECIFIC:a.set({subtype:"sequencerSpecific",
data:b.read(c)});break;default:a.set({subtype:"unknown",data:b.read(c)})}break}}break;case d.SYSEX:a.set("type","sysex");e=b.readVarInt();a.set("data",b.read(e));break;case d.DIVIDED_SYSEX:event.set("type","dividedSysex");b=stream.readVarInt();event.set("data",stream.read(b));break;default:throw Error("Unrecognized event");}else for(e in g=c,c=h.SubEventTypes,0==(g&128)?(f=g,g=this._lastEventType):(f=b.readInt8(),this._lastEventType=g),d=g>>4,a.set("channel",g&15),a.set("type","channel"),c)if(g=c[e],
d==g)switch(g){case c.NOTE_OFF:a.set("noteNumber",f);a.set("subtype","noteOff");a.set("velocity",b.readInt8());break;case c.NOTE_ON:a.set("noteNumber",f);a.set("subtype","noteOn");a.set("velocity",b.readInt8());0==a.get("velocity")&&a.set("subtype","noteOff");break;case c.NOTE_AFTER_TOUCH:a.set("noteNumber",f);a.set("subtype","noteAfterTouch");a.set("amount",b.readInt8());break;case c.CONTROLLER:a.set("subtype","controller");a.set("controllerType",f);a.set("value",b.readInt8());break;case c.PROGRAM_CHANGE:a.set("subtype",
"programChange");a.set("programNumber",f);break;case c.CHANNEL_AFTER_TOUCH:a.set("subtype","channelAfterTouch");a.set("amount",f);break;case c.PITCH_BEND:a.set("subtype","pitchBend"),a.set("coarse",f),a.set("fine",b.readInt8()),a.set("value",a.coarse+(a.fine<<7))}return a},i=function(b){var a=b.read(4),c=b.readInt32();return{id:a,length:c,data:b.read(c)}};h.Decoder=function(){};h.Decoder.prototype={decode:function(b){for(var a=i(b),c=new h.Stream(a.data),d=c.readInt16(),a=c.readInt16(),e=c.readInt16(),
c=[],d={format:d,trackCount:a,ticksPerBeat:e},e=0;e<a;e++){c[e]=new h.Track;for(var f=i(b),f=new h.Stream(f.data);!f.eof();)c[e].pushEvent(j.call(this,f))}return new h.File({header:d,tracks:c})}};return h}(jMID||{});
