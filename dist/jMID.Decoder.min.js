var jMID=function(g){var j=function(b){var a=new g.Event;a.set("time",b.readVarInt());var c=b.readInt8(),d=g.Decoder.EventTypes;if(240==(c&240))switch(c){case d.META:a.set("type","meta");var f=b.readInt8(),c=b.readVarInt(),d=g.Decoder.SubEventTypes,e;for(e in d){var h=d[e];if(f==h){switch(h){case d.SEQUENCE_NUMBER:a.set("number",b.readInt16());break;case d.MIDI_CHANNEL_PREFIX:a.set("channel",b.readInt8());break;case d.SET_TEMPO:a.set("microsecondsPreBeat",(b.readInt8()<<16)+(b.readInt8()<<8)+b.readInt8());
a.set("subtype","setTempo");break;case d.SMPTE_OFFSET:f=b.readInt8();a.set({frameRate:{"0":24,32:25,64:29,96:30}[hourByte&96],hour:f&31,min:b.readInt8(),sec:b.readInt8(),frame:b.readInt8(),subframe:b.readInt8(),subtype:"smpteOffset"});break;case d.TIME_SIGNATURE:a.set({numerator:b.readInt8(),denominator:Math.pow(2,b.readInt8()),metronome:b.readInt8(),thirtyseconds:b.readInt8(),subtype:"timeSignature"});break;case d.KEY_SIGNATURE:a.set({key:b.readInt8(!0),scale:b.readInt8(),subtype:"keySignature"});
break;case d.TEXT:a.set({subtype:"text",text:b.read(c)});break;case d.COPYRIGHT_NOTICE:a.set({subtype:"copyrightNotice",text:b.read(c)});break;case d.TRACK_NAME:a.set({subtype:"trackName",text:b.read(c)});break;case d.INSTRUMENT_NAME:a.set({subtype:"instrumentName",text:b.read(c)});break;case d.LYRICS:a.set({subtype:"lyrics",text:b.read(c)});break;case d.MARKER:a.set({subtype:"marker",text:b.read(c)});break;case d.CUE_POINT:a.set({subtype:"cuePoint",text:b.read(c)});break;case d.END_OF_TRACK:a.set("subtype",
"endOfTrack");break;case d.SEQUENCER_SPECIFIC:a.set({subtype:"sequencerSpecific",data:b.read(c)});break;default:a.set({subtype:"unknown",data:b.read(c)})}break}}break;case d.SYSEX:a.set("type","sysex");f=b.readVarInt();a.set("data",b.read(f));break;case d.DIVIDED_SYSEX:event.set("type","dividedSysex");b=stream.readVarInt();event.set("data",stream.read(b));break;default:throw Error("Unrecognized event");}else for(f in h=c,c=g.Decoder.SubEventTypes,0==(h&128)?(e=h,h=this._lastEventType):(e=b.readInt8(),
this._lastEventType=h),d=h>>4,a.set("channel",h&15),a.set("type","channel"),c)if(h=c[f],d==h)switch(h){case c.NOTE_OFF:a.set("noteNumber",e);a.set("subtype","noteOff");a.set("velocity",b.readInt8());break;case c.NOTE_ON:a.set("noteNumber",e);a.set("subtype","noteOn");a.set("velocity",b.readInt8());0==a.get("velocity")&&a.set("subtype","noteOff");break;case c.NOTE_AFTER_TOUCH:a.set("noteNumber",e);a.set("subtype","noteAfterTouch");a.set("amount",b.readInt8());break;case c.CONTROLLER:a.set("subtype",
"controller");a.set("controllerType",e);a.set("value",b.readInt8());break;case c.PROGRAM_CHANGE:a.set("subtype","programChange");a.set("programNumber",e);break;case c.CHANNEL_AFTER_TOUCH:a.set("subtype","channelAfterTouch");a.set("amount",e);break;case c.PITCH_BEND:a.set("subtype","pitchBend"),a.set("value",e+(b.readInt8()<<7))}return a},i=function(b){var a=b.read(4),c=b.readInt32();return{id:a,length:c,data:b.read(c)}};g.Decoder=function(){};g.Decoder.prototype={decode:function(b){for(var a=i(b),
c=new g.Stream(a.data),d=c.readInt16(),a=c.readInt16(),f=c.readInt16(),c=[],d={format:d,trackCount:a,ticksPerBeat:f},f=0;f<a;f++){c[f]=[];for(var e=i(b),e=new g.Stream(e.data);!e.eof();)c[f].push(j.call(this,e))}return new g.File({header:d,tracks:c})}};g.Decoder.EventTypes={META:255,SYSEX:240,DIVIDED_SYSEX:247};g.Decoder.SubEventTypes={SEQUENCE_NUMBER:0,TEXT:1,COPYRIGHT_NOTICE:2,TRACK_NAME:3,INSTRUMENT_NAME:4,LYRICS:5,MARKER:6,CUE_POINT:7,MIDI_CHANNEL_PREFIX:32,END_OF_TRACK:47,SET_TEMPO:81,SMPTE_OFFSET:84,
TIME_SIGNATURE:88,KEY_SIGNATURE:89,SEQUENCER_SPECIFIC:127,NOTE_OFF:8,NOTE_ON:9,NOTE_AFTER_TOUCH:10,CONTROLLER:11,PROGRAM_CHANGE:12,CHANNEL_AFTER_TOUCH:13,PITCH_BEND:14};return g}(jMID||{});
