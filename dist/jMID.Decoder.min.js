var jMID=function(e){var j=function(b){var a=new e.Event;a.set("time",b.readVarInt());var c=b.readInt8(),d=e.Decoder.EventTypes;if(240==(c&240))switch(c){case d.META:a.set("type",e.Decoder.EventTypes.META);var h=b.readInt8(),c=b.readVarInt(),d=e.Decoder.SubEventTypes,g;for(g in d){var f=d[g];if(h==f){a.set("subtype",f);switch(f){case d.SEQUENCE_NUMBER:a.set("number",b.readInt16());break;case d.jMID_CHANNEL_PREFIX:a.set("channel",b.readInt8());break;case d.SET_TEMPO:a.set("microsecondsPreBeat",(b.readInt8()<<
16)+(b.readInt8()<<8)+b.readInt8());break;case d.SMPTE_OFFSET:h=b.readInt8();a.set({frameRate:{"0":24,32:25,64:29,96:30}[hourByte&96],hour:h&31,min:b.readInt8(),sec:b.readInt8(),frame:b.readInt8(),subframe:b.readInt8()});break;case d.TIME_SIGNATURE:a.set({numerator:b.readInt8(),denominator:Math.pow(2,b.readInt8()),metronome:b.readInt8(),thirtyseconds:b.readInt8()});break;case d.KEY_SIGNATURE:a.set({key:b.readInt8(!0),scale:b.readInt8()});break;case d.TEXT:case d.COPYRIGHT_NOTICE:case d.TRACK_NAME:case d.INSTRUMENT_NAME:case d.LYRICS:case d.MARKER:case d.CUE_POINT:a.set("text",
b.read(c));break;case d.END_OF_TRACK:break;default:a.set("data",b.read(c))}break}}break;case d.SYSEX:a.set("type",e.Decoder.EventTypes.SYSEX);h=b.readVarInt();a.set("data",b.read(h));break;case d.DIVIDED_SYSEX:event.set("type",e.Decoder.EventTypes.DIVIDED_SYSEX);b=stream.readVarInt();event.set("data",stream.read(b));break;default:throw Error("Unrecognized event");}else for(h in f=c,c=e.Decoder.SubEventTypes,0==(f&128)?(g=f,f=this._lastEventType):(g=b.readInt8(),this._lastEventType=f),d=f>>4,a.set("channel",
f&15),a.set("type","channel"),c)if(f=c[h],d==f)switch(a.set("subtype",f),f){case c.NOTE_OFF:a.set("noteNumber",g);a.set("velocity",b.readInt8());break;case c.NOTE_ON:a.set("noteNumber",g);a.set("velocity",b.readInt8());0==a.get("velocity")&&a.set("subtype",c.NOTE_OFF);break;case c.NOTE_AFTER_TOUCH:a.set("noteNumber",g);a.set("amount",b.readInt8());break;case c.CONTROLLER:a.set("controllerType",g);a.set("value",b.readInt8());break;case c.PROGRAM_CHANGE:a.set("programNumber",g);break;case c.CHANNEL_AFTER_TOUCH:a.set("amount",
g);break;case c.PITCH_BEND:a.set("value",g+(b.readInt8()<<7))}return a},i=function(){var b=this.stream.read(4),a=this.stream.readInt32();return{id:b,length:a,data:this.stream.read(a)}};e.Decoder=function(b){this.stream=b;this.decode()};e.Decoder.prototype={decode:function(){var b=i.call(this),a=new e.Stream(b.data),c=a.readInt16(),b=a.readInt16(),a=a.readInt16();this.tracks=[];this.header={format:c,trackCount:b,ticksPerBeat:a};for(c=0;c<b;c++){this.tracks[c]=[];a=i.call(this);for(a=new e.Stream(a.data);!a.eof();)this.tracks[c].push(j.call(this,
a))}}};e.Decoder.EventTypes={META:255,SYSEX:240,DIVIDED_SYSEX:247};e.Decoder.SubEventTypes={SEQUENCE_NUMBER:0,TEXT:1,COPYRIGHT_NOTICE:2,TRACK_NAME:3,INSTRUMENT_NAME:4,LYRICS:5,MARKER:6,CUE_POINT:7,jMID_CHANNEL_PREFIX:32,END_OF_TRACK:47,SET_TEMPO:81,SMPTE_OFFSET:84,TIME_SIGNATURE:88,KEY_SIGNATURE:89,SEQUENCER_SPECIFIC:127,NOTE_OFF:8,NOTE_ON:9,NOTE_AFTER_TOUCH:10,CONTROLLER:11,PROGRAM_CHANGE:12,CHANNEL_AFTER_TOUCH:13,PITCH_BEND:14};return e}(jMID||{});
