var jMID=function(f){var j=function(b){var a={};a.time=b.readVarInt();var c=b.readInt8(),d=f.Decoder.EventTypes;if(240==(c&240))switch(c){case d.META:a.type=f.Decoder.EventTypes.META;var h=b.readInt8(),c=b.readVarInt(),d=f.Decoder.SubEventTypes,g;for(g in d){var e=d[g];if(h==e){a.subtype=e;switch(e){case d.SEQUENCE_NUMBER:a.number=b.readInt16();break;case d.jMID_CHANNEL_PREFIX:a.channel=b.readInt8();break;case d.SET_TEMPO:a.microsecondsPreBeat=(b.readInt8()<<16)+(b.readInt8()<<8)+b.readInt8();break;
case d.SMPTE_OFFSET:h=b.readInt8();a.frameRate={"0":24,32:25,64:29,96:30}[hourByte&96];a.hour=h&31;a.min=b.readInt8();a.sec=b.readInt8();a.frame=b.readInt8();a.subframe=b.readInt8();break;case d.TIME_SIGNATURE:a.numerator=b.readInt8();a.denominator=Math.pow(2,b.readInt8());a.metronome=b.readInt8();a.thirtyseconds=b.readInt8();break;case d.KEY_SIGNATURE:a.key=b.readInt8(!0);a.scale=b.readInt8();break;case d.TEXT:case d.COPYRIGHT_NOTICE:case d.TRACK_NAME:case d.INSTRUMENT_NAME:case d.LYRICS:case d.MARKER:case d.CUE_POINT:a.text=
b.read(c);break;case d.END_OF_TRACK:break;default:a.data=b.read(c)}break}}break;case d.SYSEX:a.type=f.Decoder.EventTypes.SYSEX;h=b.readVarInt();a.data=b.read(h);break;case d.DIVIDED_SYSEX:event.type=f.Decoder.EventTypes.DIVIDED_SYSEX;b=stream.readVarInt();event.data=stream.read(b);break;default:throw Error("Unrecognized event");}else for(h in e=c,c=f.Decoder.SubEventTypes,0==(e&128)?(g=e,e=this._lastEventType):(g=b.readInt8(),this._lastEventType=e),d=e>>4,a.channel=e&15,a.type="channel",c)if(e=c[h],
d==e)switch(a.subtype=e,e){case c.NOTE_OFF:a.noteNumber=g;a.velocity=b.readInt8();break;case c.NOTE_ON:a.noteNumber=g;a.velocity=b.readInt8();0==a.velocity&&(a.subtype=c.NOTE_OFF);break;case c.NOTE_AFTER_TOUCH:a.noteNumber=g;a.amount=b.readInt8();break;case c.CONTROLLER:a.controllerType=g;a.value=b.readInt8();break;case c.PROGRAM_CHANGE:a.programNumber=g;break;case c.CHANNEL_AFTER_TOUCH:a.amount=g;break;case c.PITCH_BEND:a.value=g+(b.readInt8()<<7)}return a},i=function(){var b=this.stream.read(4),
a=this.stream.readInt32();return{id:b,length:a,data:this.stream.read(a)}};f.Decoder=function(b){this.stream=b;this.decode()};f.Decoder.prototype={decode:function(){var b=i.call(this),a=new f.Stream(b.data),c=a.readInt16(),b=a.readInt16(),a=a.readInt16();this.tracks=[];this.header={format:c,trackCount:b,ticksPerBeat:a};for(c=0;c<b;c++){this.tracks[c]=[];a=i.call(this);for(a=new f.Stream(a.data);!a.eof();)this.tracks[c].push(j.call(this,a))}}};f.Decoder.EventTypes={META:255,SYSEX:240,DIVIDED_SYSEX:247};
f.Decoder.SubEventTypes={SEQUENCE_NUMBER:0,TEXT:1,COPYRIGHT_NOTICE:2,TRACK_NAME:3,INSTRUMENT_NAME:4,LYRICS:5,MARKER:6,CUE_POINT:7,jMID_CHANNEL_PREFIX:32,END_OF_TRACK:47,SET_TEMPO:81,SMPTE_OFFSET:84,TIME_SIGNATURE:88,KEY_SIGNATURE:89,SEQUENCER_SPECIFIC:127,NOTE_OFF:8,NOTE_ON:9,NOTE_AFTER_TOUCH:10,CONTROLLER:11,PROGRAM_CHANGE:12,CHANNEL_AFTER_TOUCH:13,PITCH_BEND:14};return f}(jMID||{});
