var jMID=function(e){e.Util={isObject:function(c){return c===Object(c)}};for(var b="Arguments Function String Number Date RegExp".split(" "),a=b.length-1;0<=a;a--)(function(c){e.Util["is"+c]=function(d){return toString.call(d)=="[object "+c+"]"}})(b[a]);return e}(jMID||{}),jMID=function(e){var b;e.Event=function(){b=e.Util};e.Event.prototype={set:function(){var a=arguments;if(b.isObject(a[0]))for(var c in a[0])a[0].hasOwnProperty(c)&&(this[c]=a[0][c]);else if(b.isString(a[0]))this[a[0]]=a[1];else return null},
get:function(a){return this[a]}};return e}(jMID||{}),jMID=function(e){e.Stream=function(b){this.index=0;this.string=b};e.Stream.prototype={read:function(b){var a=this.string.substr(this.index,b);this.index+=b;return a},readInt32:function(){var b=this.string,a=this.index,b=(b.charCodeAt(a)<<24)+(b.charCodeAt(a+1)<<16)+(b.charCodeAt(a+2)<<8)+b.charCodeAt(a+3);this.index+=4;return b},readInt16:function(){var b=this.string,a=this.index,b=(b.charCodeAt(a)<<8)+b.charCodeAt(a+1);this.index+=2;return b},
readInt8:function(b){var a=this.string.charCodeAt(this.index);this.index+=1;return b&&127<a?a-256:a},eof:function(){return this.index>=this.string.length},readVarInt:function(){for(var b=0;;){var a=this.readInt8();if(a&128)b+=a&127,b<<=7;else return b+a}}};return e}(jMID||{}),jMID=function(e){var b=function(c){var d=new e.Event;d.set("time",c.readVarInt());var a=c.readInt8(),b=e.Decoder.EventTypes;if(240==(a&240))switch(a){case b.META:d.set("type",e.Decoder.EventTypes.META);var i=c.readInt8(),a=c.readVarInt(),
b=e.Decoder.SubEventTypes,g;for(g in b){var f=b[g];if(i==f){d.set("subtype",f);switch(f){case b.SEQUENCE_NUMBER:d.set("number",c.readInt16());break;case b.jMID_CHANNEL_PREFIX:d.set("channel",c.readInt8());break;case b.SET_TEMPO:d.set("microsecondsPreBeat",(c.readInt8()<<16)+(c.readInt8()<<8)+c.readInt8());break;case b.SMPTE_OFFSET:i=c.readInt8();d.set({frameRate:{"0":24,32:25,64:29,96:30}[hourByte&96],hour:i&31,min:c.readInt8(),sec:c.readInt8(),frame:c.readInt8(),subframe:c.readInt8()});break;case b.TIME_SIGNATURE:d.set({numerator:c.readInt8(),
denominator:Math.pow(2,c.readInt8()),metronome:c.readInt8(),thirtyseconds:c.readInt8()});break;case b.KEY_SIGNATURE:d.set({key:c.readInt8(!0),scale:c.readInt8()});break;case b.TEXT:case b.COPYRIGHT_NOTICE:case b.TRACK_NAME:case b.INSTRUMENT_NAME:case b.LYRICS:case b.MARKER:case b.CUE_POINT:d.set("text",c.read(a));break;case b.END_OF_TRACK:break;default:d.set("data",c.read(a))}break}}break;case b.SYSEX:d.set("type",e.Decoder.EventTypes.SYSEX);i=c.readVarInt();d.set("data",c.read(i));break;case b.DIVIDED_SYSEX:event.set("type",
e.Decoder.EventTypes.DIVIDED_SYSEX);c=stream.readVarInt();event.set("data",stream.read(c));break;default:throw Error("Unrecognized event");}else for(i in f=a,a=e.Decoder.SubEventTypes,0==(f&128)?(g=f,f=this._lastEventType):(g=c.readInt8(),this._lastEventType=f),b=f>>4,d.set("channel",f&15),d.set("type","channel"),a)if(f=a[i],b==f)switch(d.set("subtype",f),f){case a.NOTE_OFF:d.set("noteNumber",g);d.set("velocity",c.readInt8());break;case a.NOTE_ON:d.set("noteNumber",g);d.set("velocity",c.readInt8());
0==d.get("velocity")&&d.set("subtype",a.NOTE_OFF);break;case a.NOTE_AFTER_TOUCH:d.set("noteNumber",g);d.set("amount",c.readInt8());break;case a.CONTROLLER:d.set("controllerType",g);d.set("value",c.readInt8());break;case a.PROGRAM_CHANGE:d.set("programNumber",g);break;case a.CHANNEL_AFTER_TOUCH:d.set("amount",g);break;case a.PITCH_BEND:d.set("value",g+(c.readInt8()<<7))}return d},a=function(){var a=this.stream.read(4),d=this.stream.readInt32();return{id:a,length:d,data:this.stream.read(d)}};e.Decoder=
function(a){this.stream=a;this.decode()};e.Decoder.prototype={decode:function(){var c=a.call(this),d=new e.Stream(c.data),l=d.readInt16(),c=d.readInt16(),d=d.readInt16();this.tracks=[];this.header={format:l,trackCount:c,ticksPerBeat:d};for(l=0;l<c;l++){this.tracks[l]=[];d=a.call(this);for(d=new e.Stream(d.data);!d.eof();)this.tracks[l].push(b.call(this,d))}}};e.Decoder.EventTypes={META:255,SYSEX:240,DIVIDED_SYSEX:247};e.Decoder.SubEventTypes={SEQUENCE_NUMBER:0,TEXT:1,COPYRIGHT_NOTICE:2,TRACK_NAME:3,
INSTRUMENT_NAME:4,LYRICS:5,MARKER:6,CUE_POINT:7,jMID_CHANNEL_PREFIX:32,END_OF_TRACK:47,SET_TEMPO:81,SMPTE_OFFSET:84,TIME_SIGNATURE:88,KEY_SIGNATURE:89,SEQUENCER_SPECIFIC:127,NOTE_OFF:8,NOTE_ON:9,NOTE_AFTER_TOUCH:10,CONTROLLER:11,PROGRAM_CHANGE:12,CHANNEL_AFTER_TOUCH:13,PITCH_BEND:14};return e}(jMID||{}),jMID=function(e){var b=function(){for(var a=this.slice(0),b,c=arguments,e=c.length,g;e&&a.length;)for(b=c[--e];-1!==(g=a.indexOf(b));)a.splice(g,1);return a},a=function(a){for(var b=a.split(",").map(function(a){return a.trim()}),
a=[],c=0,e=b.length;c<e;c++)a.push(b[c].split(" "));b=[];c=0;for(e=a.length;c<e;c++)for(var g=a[c],f=0,s=this._results.tracks.length;f<s;f++){var r=this._results.tracks[f];b.push([]);for(var q=0,t=r.length;q<t;q++){for(var m=r[q],k=!1,p=0,u=g.length;p<u;p++){var n;a:{n=g[p];for(var j=[":",">",">=","<","<="],h=j.length-1;0<=h;h--)if(-1!==n.search(j[h])){n=j[h];break a}n=void 0}h=g[p].split(n);j=h[0];h=h[1];switch(n){case ":":k=m[j]==h;break;case ">":k=m[j]>h;break;case ">=":k=m[j]>=h;break;case "<":k=
m[j]<h;break;case "<=":k=m[j]<=h}if(!k)break}k&&b[f].push(m)}}return{tracks:b}},c=function(a,c){this._results=c?c:{tracks:a.tracks.slice(0)};this._decoder=a};c.prototype={filter:function(b){b=a.call(this,b);return new c(this._decoder,b)},not:function(d){for(var d=d?a.call(this,d):this._results,e=[],o=0,i=d.tracks.length;o<i;o++)e.push(b.apply(this._results.tracks[o],d.tracks[o]));return new c(this._decoder,{tracks:e})},apply:function(){for(var a=0,b=this._results.tracks.length;a<b;a++)this._decoder.tracks[a]=
this._results.tracks[a].slice(0);return new c(this._decoder)}};e.Query=function(a){if(!a)throw Error("Midi is needed for querying");return new c(a)};return e}(jMID||{}),jMID=function(e){var b="C ;C#;D ;D#;E ;F ;F#;G ;G#;A ;A#;B ".split(";");e.Converter=function(){this.setType(e.Converter.Types.NOTE_TO_FREQUENCY)};e.Converter.prototype={noteToFrequency:function(a){return 0<=a&&119>=a?440*Math.pow(2,(a-69)/12):-1},noteToName:function(a){return 0<=a&&119>=a?(b[a%12]+Math.round(a/12).toString()).replace(/\s+/g,
""):"---"},frequencyToNote:function(a){return Math.round(12*(Math.log(a/440)/Math.log(2)))+69},nameToNote:function(a){var c,d,e;if(2===a.length)d=a[0]+" "+a[1];else if(2<a.length)return-1;d.toUpperCase();a=-1;c=0;for(e=b.length;c<e;c++)if(b[c]===d[0]+d[1]){a=c;break}try{return c=parseInt(d[2],10),12*c+a}catch(o){return-1}},convert:function(a){switch(this._type){case 0:return this.noteToFrequency(a);case 1:return this.noteToName(a);case 2:return this.frequencyToNote(a);case 3:return this.nameToNote(a)}},
setType:function(a){this._type=a}};e.Converter.Types={NOTE_TO_FREQUENCY:0,NOTE_TO_NAME:1,FREQUENCY_TO_NOTE:2,NAME_TO_NOTE:3};return e}(jMID||{});
