var jMID=function(e){e.Util={isObject:function(d){return d===Object(d)},asciiToHex:function(d){for(var c="",a=0,b=d.length;a<b;a++)c+=d.charCodeAt(a).toString(16);return c},hexToAscii:function(d){console.log(d);for(var c="",a=0,b=d.length;a<b;a++)c+=String.fromCharCode(parseInt(d.substr(a,2),16)),d[a];return c},hexToBinary:function(d){return d.toString(2)},bytesToString:function(d){for(var c="",a=0,b=d.length;a<b;a++)c=e.Util.isString(d[a])?c+d[a]:c+String.fromCharCode(d[a]);return c},stringToBytes:function(d,
c){if(c)for(;d.length/2<c;)d="0"+d;for(var a=[],b=d.length-1;0<=b;b-=2)a.unshift(parseInt(0===b?d[b]:d[b-1]+d[b],16));return a},writeVarInt:function(d){for(var c=d&127;d>>=7;)c<<=8,c|=d&127|128;for(d=[];;)if(d.push(c&255),c&128)c>>=8;else break;return d},getType:function(d){var c=e.SubEventTypes;switch(d){case "sequenceNumber":return c.SEQUENCER_NUMBER;case "text":return c.TEXT;case "copyrightNotice":return c.COPYRIGHT_NOTICE;case "trackName":return c.TRACK_NAME;case "instrumentName":return c.INSTRUMENT_NAME;
case "lyrics":return c.LYRICS;case "marker":return c.MARKER;case "cuePoint":return c.CUE_POINT;case "midiChannelPrefix":return c.MIDI_CHANNEL_PREFIX;case "endOfTrack":return c.END_OF_TRACK;case "setTempo":return c.SET_TEMPO;case "smpteOffset":return c.SMPTE_OFFSET;case "timeSignature":return c.TIME_SIGNATURE;case "sequencerSpecific":return c.SEQUENCER_SPECIFIC;case "noteOff":return c.NOTE_OFF;case "noteOn":return c.NOTE_ON;case "noteAfterTouch":return c.NOTE_AFTER_TOUCH;case "controller":return c.CONTROLLER;
case "programChange":return c.PROGRAM_CHANGE;case "channelAfterTouch":return c.CHANNEL_AFTER_TOUCH;case "pitchBend":return c.PITCH_BEND}}};for(var b="Arguments Function String Number Date RegExp".split(" "),a=b.length-1;0<=a;a--)(function(d){e.Util["is"+d]=function(c){return toString.call(c)=="[object "+d+"]"}})(b[a]);return e}(jMID||{}),jMID=function(e){e.EventTypes={META:255,SYSEX:240,DIVIDED_SYSEX:247};e.SubEventTypes={SEQUENCE_NUMBER:0,TEXT:1,COPYRIGHT_NOTICE:2,TRACK_NAME:3,INSTRUMENT_NAME:4,
LYRICS:5,MARKER:6,CUE_POINT:7,MIDI_CHANNEL_PREFIX:32,END_OF_TRACK:47,SET_TEMPO:81,SMPTE_OFFSET:84,TIME_SIGNATURE:88,KEY_SIGNATURE:89,SEQUENCER_SPECIFIC:127,NOTE_OFF:8,NOTE_ON:9,NOTE_AFTER_TOUCH:10,CONTROLLER:11,PROGRAM_CHANGE:12,CHANNEL_AFTER_TOUCH:13,PITCH_BEND:14};return e}(jMID||{}),jMID=function(e){e.Event=function(){};e.Event.prototype={set:function(){var b=e.Util,a=arguments;if(b.isObject(a[0]))for(var d in a[0])a[0].hasOwnProperty(d)&&(this[d]=a[0][d]);else if(b.isString(a[0]))this[a[0]]=a[1];
else return null},get:function(b){return this[b]},encode:function(){if("meta"===this.type){var b=[];Array.prototype.push.apply(b,e.Util.writeVarInt(this.deltaTime));b.push(255,e.Util.getType(this.subtype));switch(this.subtype){case "sequenceNumber":b.push(1,this.number);break;case "midiChannelPrefix":b.push(1,this.channel);break;case "setTempo":b.push(3,(this.microsecondsPerBeat&16711680)>>16,(this.microsecondsPerBeat&65280)>>8,this.microsecondsPerBeat&255);break;case "smpteOffset":b.push(5,this.hourByte,
this.min,this.sec,this.frame,this.subframe);break;case "timeSignature":b.push(4,this.numerator,Math.log(this.denominator)/Math.log(2),this.metronome,this.thirtyseconds);break;case "keySignature":b.push(2,this.key,this.scale);break;case "copyrightNotice":case "text":case "trackName":case "instrumentName":case "lyrics":case "marker":case "cuePoint":var a=this.text.split("");Array.prototype.push.apply(b,[a.length].concat(a));break;case "sequencerSpecific":case "unknown":b.push(1,this.data);break;case "endOfTrack":b.push(0)}return b}b=
[];a=e.Util.getType(this.subtype);a=parseInt(a.toString(16)+this.channel.toString(16),16);Array.prototype.push.apply(b,e.Util.writeVarInt(this.deltaTime));b.push(a);switch(this.subtype){case "noteOn":case "noteOff":b.push(this.noteNumber,this.velocity);break;case "noteAfterTouch":b.push(this.noteNumber,this.amount);break;case "controller":b.push(this.controllerType,this.value);break;case "programChange":byteArry.push(this.programNumber);break;case "channelAfterTouch":b.push(this.amount);break;case "pitchBend":b.push(this.course,
this.fine)}return b}};return e}(jMID||{}),jMID=function(e){e.Track=function(b){this.events=b||[]};e.Track.prototype={pushEvent:function(b){this.events.push(b);return this},getEvents:function(b){return"undefined"!==typeof b?0<=b&&b<this.events.length?this.events[b]:null:this.events},removeEvents:function(){for(var b,a=arguments,d=a.length,c;d&&this.events.length;)for(b=a[--d];-1!==(c=this.events.indexOf(b));)this.events.splice(c,1);return this},cloneEvents:function(){return this.events.slice(0)},encode:function(){for(var b=
[],a=0,d=0,c=this.events.length;d<c;d++){var h=this.getEvents(d).encode(),a=a+h.length;Array.prototype.push.apply(b,h)}a=e.Util.stringToBytes(a.toString(16),4);return e.Util.bytesToString([77,84,114,107].concat(a,b))}};return e}(jMID||{}),jMID=function(e){e.Stream=function(b){this.index=0;this.string=b};e.Stream.prototype={read:function(b){var a=this.string.substr(this.index,b);this.index+=b;return a},readInt32:function(){var b=this.string,a=this.index,b=(b.charCodeAt(a)<<24)+(b.charCodeAt(a+1)<<
16)+(b.charCodeAt(a+2)<<8)+b.charCodeAt(a+3);this.index+=4;return b},readInt16:function(){var b=this.string,a=this.index,b=(b.charCodeAt(a)<<8)+b.charCodeAt(a+1);this.index+=2;return b},readInt8:function(b){var a=this.string.charCodeAt(this.index);this.index+=1;return b&&127<a?a-256:a},eof:function(){return this.index>=this.string.length},readVarInt:function(){for(var b=0;;){var a=this.readInt8();if(a&128)b+=a&127,b<<=7;else return b+a}}};return e}(jMID||{}),jMID=function(e){e.File=function(b){for(var a in b)b.hasOwnProperty(a)&&
(this[a]=b[a]);this.timeSignature={beatsPerBar:4,beatValue:4};this.timing={MicroSPB:5E5};this.processMetaEvents();this.processChannelEventTimes()};e.File.prototype={processMetaEvents:function(){for(var b=e.Query(this).filter("type:meta").not("subtype:endOfTrack, subtype:trackName").toArray(),a=0,d=b.length;a<d;a++)switch(b[a].subtype){case "timeSignature":this.timeSignature.beatsPerBar=b[a].numerator;this.timeSignature.beatValue=b[a].denominator;break;case "setTempo":this.timing.MicroSPB=b[a].microsecondsPerBeat}this.calculateBPM();
this.timing.MSPQN=this.timing.MicroSPB/1E3;this.timing.MSPT=this.timing.MSPQN/this.header.ticksPerBeat},processChannelEventTimes:function(){for(var b=this.timing.MSPT,a=0,d=this.tracks.length;a<d;a++)for(var c=this.tracks[a],e=0,i=0,g=c.events.length;i<g;i++){var f=c.events[i],j=f.deltaTime*b;f.set("time",e+j);e+=j}},calculateBPM:function(){this.timing.BPM=6E7/this.timing.MicroSPB*(this.timeSignature.beatValue/4)},getHeader:function(){return this.header},encode:function(){return(new e.Encoder).encode(this)},
base64Encode:function(){return btoa(this.encode())}};return e}(jMID||{}),jMID=function(){jMID.Encoder=function(){};jMID.Encoder.prototype={encode:function(e){for(var b="",a=e.getHeader(),d=jMID.Util,b=b+"MThd\x00\x00\x00\u0006"+(0===a.format?"\x00\x00":"\x00\u0001"),b=b+d.bytesToString(d.stringToBytes(a.trackCount.toString(),2)),b=b+d.bytesToString([a.ticksPerBeat>>8,a.ticksPerBeat&255]),a=0,d=e.tracks.length;a<d;a++)var c=e.tracks[a].encode(),b=b+c;return b}};jMID.Encoder.Notes={G9:127,Gb9:126,F9:125,
E9:124,Eb9:123,D9:122,Db9:121,C9:120,B8:119,Bb8:118,A8:117,Ab8:116,G8:115,Gb8:114,F8:113,E8:112,Eb8:111,D8:110,Db8:109,C8:108,B7:107,Bb7:106,A7:105,Ab7:104,G7:103,Gb7:102,F7:101,E7:100,Eb7:99,D7:98,Db7:97,C7:96,B6:95,Bb6:94,A6:93,Ab6:92,G6:91,Gb6:90,F6:89,E6:88,Eb6:87,D6:86,Db6:85,C6:84,B5:83,Bb5:82,A5:81,Ab5:80,G5:79,Gb5:78,F5:77,E5:76,Eb5:75,D5:74,Db5:73,C5:72,B4:71,Bb4:70,A4:69,Ab4:68,G4:67,Gb4:66,F4:65,E4:64,Eb4:63,D4:62,Db4:61,C4:60,B3:59,Bb3:58,A3:57,Ab3:56,G3:55,Gb3:54,F3:53,E3:52,Eb3:51,D3:50,
Db3:49,C3:48,B2:47,Bb2:46,A2:45,Ab2:44,G2:43,Gb2:42,F2:41,E2:40,Eb2:39,D2:38,Db2:37,C2:36,B1:35,Bb1:34,A1:33,Ab1:32,G1:31,Gb1:30,F1:29,E1:28,Eb1:27,D1:26,Db1:25,C1:24,B0:23,Bb0:22,A0:21,Ab0:20,G0:19,Gb0:18,F0:17,E0:16,Eb0:15,D0:14,Db0:13,C0:12};return jMID}(jMID||{}),jMID=function(e){var b=function(d){var c=new e.Event;c.set("deltaTime",d.readVarInt());var a=d.readInt8(),b=e.EventTypes;if(240==(a&240))switch(a){case b.META:c.set("type","meta");var g=d.readInt8(),a=d.readVarInt(),b=e.SubEventTypes,
f;for(f in b){var j=b[f];if(g==j){switch(j){case b.SEQUENCE_NUMBER:c.set("number",d.readInt16());break;case b.MIDI_CHANNEL_PREFIX:c.set("channel",d.readInt8());break;case b.SET_TEMPO:c.set("microsecondsPerBeat",(d.readInt8()<<16)+(d.readInt8()<<8)+d.readInt8());c.set("subtype","setTempo");break;case b.SMPTE_OFFSET:g=d.readInt8();c.set({hourByte:g,frameRate:{"0":24,32:25,64:29,96:30}[g&96],hour:g&31,min:d.readInt8(),sec:d.readInt8(),frame:d.readInt8(),subframe:d.readInt8(),subtype:"smpteOffset"});
break;case b.TIME_SIGNATURE:c.set({numerator:d.readInt8(),denominator:Math.pow(2,d.readInt8()),metronome:d.readInt8(),thirtyseconds:d.readInt8(),subtype:"timeSignature"});break;case b.KEY_SIGNATURE:c.set({key:d.readInt8(!0),scale:d.readInt8(),subtype:"keySignature"});break;case b.TEXT:c.set({subtype:"text",text:d.read(a)});break;case b.COPYRIGHT_NOTICE:c.set({subtype:"copyrightNotice",text:d.read(a)});break;case b.TRACK_NAME:c.set({subtype:"trackName",text:d.read(a)});break;case b.INSTRUMENT_NAME:c.set({subtype:"instrumentName",
text:d.read(a)});break;case b.LYRICS:c.set({subtype:"lyrics",text:d.read(a)});break;case b.MARKER:c.set({subtype:"marker",text:d.read(a)});break;case b.CUE_POINT:c.set({subtype:"cuePoint",text:d.read(a)});break;case b.END_OF_TRACK:c.set("subtype","endOfTrack");break;case b.SEQUENCER_SPECIFIC:c.set({subtype:"sequencerSpecific",data:d.read(a)});break;default:c.set({subtype:"unknown",data:d.read(a)})}break}}break;case b.SYSEX:c.set("type","sysex");g=d.readVarInt();c.set("data",d.read(g));break;case b.DIVIDED_SYSEX:event.set("type",
"dividedSysex");d=stream.readVarInt();event.set("data",stream.read(d));break;default:throw Error("Unrecognized event");}else for(g in j=a,a=e.SubEventTypes,0==(j&128)?(f=j,j=this._lastEventType):(f=d.readInt8(),this._lastEventType=j),b=j>>4,c.set("channel",j&15),c.set("type","channel"),a)if(j=a[g],b==j)switch(j){case a.NOTE_OFF:c.set("noteNumber",f);c.set("subtype","noteOff");c.set("velocity",d.readInt8());break;case a.NOTE_ON:c.set("noteNumber",f);c.set("subtype","noteOn");c.set("velocity",d.readInt8());
0==c.get("velocity")&&c.set("subtype","noteOff");break;case a.NOTE_AFTER_TOUCH:c.set("noteNumber",f);c.set("subtype","noteAfterTouch");c.set("amount",d.readInt8());break;case a.CONTROLLER:c.set("subtype","controller");c.set("controllerType",f);c.set("value",d.readInt8());break;case a.PROGRAM_CHANGE:c.set("subtype","programChange");c.set("programNumber",f);break;case a.CHANNEL_AFTER_TOUCH:c.set("subtype","channelAfterTouch");c.set("amount",f);break;case a.PITCH_BEND:c.set("subtype","pitchBend"),c.set("coarse",
f),c.set("fine",d.readInt8()),c.set("value",c.coarse+(c.fine<<7))}return c},a=function(a){var c=a.read(4),b=a.readInt32();return{id:c,length:b,data:a.read(b)}};e.Decoder=function(){};e.Decoder.prototype={decode:function(d){for(var c=a(d),h=new e.Stream(c.data),i=h.readInt16(),c=h.readInt16(),g=h.readInt16(),h=[],i={format:i,trackCount:c,ticksPerBeat:g},g=0;g<c;g++){h[g]=new e.Track;for(var f=a(d),f=new e.Stream(f.data);!f.eof();)h[g].pushEvent(b.call(this,f))}return new e.File({header:i,tracks:h})}};
return e}(jMID||{}),jMID=function(e){var b=function(a){for(var b=a.split(",").map(function(a){return a.trim()}),a=[],h=0,i=b.length;h<i;h++)a.push(b[h].split(" "));b=[];h=0;for(i=this._results.tracks.length;h<i;h++){var g=this._results.tracks[h];b.push(new e.Track);for(var f=0,j=g.getEvents().length;f<j;f++)for(var n=g.getEvents(f),m=!1,q=0,s=a.length;q<s;q++){for(var r=a[q],p=0,t=r.length;p<t;p++){var o;a:{o=r[p];for(var l=[":",">",">=","<","<="],k=l.length-1;0<=k;k--)if(-1!==o.search(l[k])){o=l[k];
break a}o=void 0}k=r[p].split(o);l=k[0];k=k[1];switch(o){case ":":m=n[l]==k;break;case ">":m=n[l]>k;break;case ">=":m=n[l]>=k;break;case "<":m=n[l]<k;break;case "<=":m=n[l]<=k}if(!m)break}m&&b[h].pushEvent(n)}}return{tracks:b}},a=function(a,b){this._results=b?b:{tracks:a.tracks.slice(0)};this._file=a};a.prototype={filter:function(d){d=b.call(this,d);return new a(this._file,d)},not:function(d){for(var d=b.call(this,d),c=this._results,h=[],i=0,g=c.tracks.length;i<g;i++){var f=new e.Track(c.tracks[i].cloneEvents());
f.removeEvents.apply(f,d.tracks[i].getEvents());h.push(f)}return new a(this._file,{tracks:h})},toArray:function(){for(var a=[],b=0,e=this._results.tracks.length;b<e;b++)a=a.concat(this._results.tracks[b].events);return a},apply:function(){for(var b=0,c=this._results.tracks.length;b<c;b++)this._file.tracks[b]=new e.Track(this._results.tracks[b].cloneEvents());return new a(this._file)}};e.Query=function(b){if(!b)throw Error("jMID.File is needed for querying");return new a(b)};return e}(jMID||{}),jMID=
function(e){var b="C ;C#;D ;D#;E ;F ;F#;G ;G#;A ;A#;B ".split(";");e.Converter=function(){this.setType(e.Converter.Types.NOTE_TO_FREQUENCY)};e.Converter.prototype={noteToFrequency:function(a){return 0<=a&&119>=a?440*Math.pow(2,(a-69)/12):-1},noteToName:function(a){return 0<=a&&119>=a?(b[a%12]+Math.round(a/12).toString()).replace(/\s+/g,""):"---"},frequencyToNote:function(a){return Math.round(12*(Math.log(a/440)/Math.log(2)))+69},nameToNote:function(a){var d,c,e;if(2===a.length)c=a[0]+" "+a[1];else if(2<
a.length)return-1;c.toUpperCase();a=-1;d=0;for(e=b.length;d<e;d++)if(b[d]===c[0]+c[1]){a=d;break}try{return d=parseInt(c[2],10),12*d+a}catch(i){return-1}},convert:function(a){switch(this._type){case 0:return this.noteToFrequency(a);case 1:return this.noteToName(a);case 2:return this.frequencyToNote(a);case 3:return this.nameToNote(a)}},setType:function(a){this._type=a}};e.Converter.Types={NOTE_TO_FREQUENCY:0,NOTE_TO_NAME:1,FREQUENCY_TO_NOTE:2,NAME_TO_NOTE:3};return e}(jMID||{});
