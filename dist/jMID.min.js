/**
 * jMID.min.js v0.1
 *
 * A javascript library for reading, manipulating, and writing MIDI files
 * @author Steven Sojka - Friday, February 01, 2013
 *
 * MIT Licensed
 */
var jMID=function(c){c.EventTypes={META:255,SYSEX:240,DIVIDED_SYSEX:247};c.SubEventTypes={SEQUENCE_NUMBER:0,TEXT:1,COPYRIGHT_NOTICE:2,TRACK_NAME:3,INSTRUMENT_NAME:4,LYRICS:5,MARKER:6,CUE_POINT:7,MIDI_CHANNEL_PREFIX:32,END_OF_TRACK:47,SET_TEMPO:81,SMPTE_OFFSET:84,TIME_SIGNATURE:88,KEY_SIGNATURE:89,SEQUENCER_SPECIFIC:127,NOTE_OFF:8,NOTE_ON:9,NOTE_AFTER_TOUCH:10,CONTROLLER:11,PROGRAM_CHANGE:12,CHANNEL_AFTER_TOUCH:13,PITCH_BEND:14};return c}(jMID||{}),jMID=function(c){var a=Array.prototype;c.Util={isObject:function(b){return b===
Object(b)},asciiToHex:function(b){for(var a="",g=0,e=b.length;g<e;g++)a+=b.charCodeAt(g).toString(16);return a},hexToAscii:function(b){return a},stringToBytes:function(b,a){if(a)for(;b.length/2<a;)b="0"+b;for(var e=[],
c=b.length-1;0<=c;c-=2)e.unshift(parseInt(0===c?b[c]:b[c-1]+b[c],16));return e},writeVarInt:function(b){for(var a=b&127;b>>=7;)a<<=8,a|=b&127|128;for(b=[];;)if(b.push(a&255),a&128)a>>=8;else break;return b},getType:function(b){var a=c.SubEventTypes;switch(b){case "sequenceNumber":return a.SEQUENCER_NUMBER;case "text":return a.TEXT;case "copyrightNotice":return a.COPYRIGHT_NOTICE;case "trackName":return a.TRACK_NAME;case "instrumentName":return a.INSTRUMENT_NAME;case "lyrics":return a.LYRICS;case "marker":return a.MARKER;
case "cuePoint":return a.CUE_POINT;case "midiChannelPrefix":return a.MIDI_CHANNEL_PREFIX;case "endOfTrack":return a.END_OF_TRACK;case "setTempo":return a.SET_TEMPO;case "smpteOffset":return a.SMPTE_OFFSET;case "timeSignature":return a.TIME_SIGNATURE;case "sequencerSpecific":return a.SEQUENCER_SPECIFIC;case "noteOff":return a.NOTE_OFF;case "noteOn":return a.NOTE_ON;case "noteAfterTouch":return a.NOTE_AFTER_TOUCH;case "controller":return a.CONTROLLER;case "programChange":return a.PROGRAM_CHANGE;case "channelAfterTouch":return a.CHANNEL_AFTER_TOUCH;
case "pitchBend":return a.PITCH_BEND}},forAllEvents:function(b,e){var c=this,f=a.slice.call(arguments);f.splice(0,2);this.forEachTrack(b,function(b,a){c.forEachEvent.apply(c,[b,e,a].concat(f))})},forAllNotes:function(b,e){var c=this,f=a.slice.call(arguments);f.splice(0,2);this.forEachTrack(b,function(b,a){c.forEachNote.apply(c,[b,e,a].concat(f))})},forEachTrack:function(b,e){var c=a.slice.call(arguments);c.splice(0,2);for(var f=0,i=b.length;f<i;f++)e.apply(this,[b[f],f].concat(c))},forEachNote:function(b,
e){var c=a.slice.call(arguments);c.splice(0,2);for(var f=0,i=b.notes.length;f<i;f++)e.apply(this,[b.notes[f],f].concat(c))},forEachEvent:function(b,e){var c=a.slice.call(arguments);c.splice(0,2);for(var f=0,i=b.events.length;f<i;f++)e.apply(this,[b.events[f],f].concat(c))},inRange:function(b,a,e){return b>=a&&b<=e}};for(var b="Arguments Function String Number Date RegExp".split(" "),e=b.length-1;0<=e;e--)(function(b){c.Util["is"+b]=function(a){return toString.call(a)=="[object "+b+"]"}})(b[e]);return c}(jMID||
{}),jMID=function(c){c.Emitter=function(){};c.Emitter.prototype={on:function(a,b){this.__events=this.__events||{};this.__events[a]=this.__events[a]||[];this.__events[a].push(b)},off:function(a,b){this.__events=this.__events||{};a in this.__events&&this.__events[a].splice(this.__events[a].indexOf(b),1)},trigger:function(a){this.__events=this.__events||{};if(a in this.__events)for(var b=0,e=this.__events[a].length;b<e;b++)this.__events[a][b].apply(this,Array.prototype.slice.call(arguments,1))}};c.Emitter.register=
function(a){for(var b in c.Emitter.prototype)c.Emitter.prototype.hasOwnProperty(b)&&(a.prototype[b]=c.Emitter.prototype[b])};return c}(jMID||{}),jMID=function(c){c.Event=function(a){this.track=null;for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};c.Event.prototype={set:function(){var a=c.Util,b=arguments;if(a.isObject(b[0]))for(var e in b[0])b[0].hasOwnProperty(e)&&(this[e]=b[0][e]);else if(a.isString(b[0]))this[b[0]]=b[1];else return null},get:function(a){return this[a]},encode:function(){if("meta"===
this.type){var a=[];Array.prototype.push.apply(a,c.Util.writeVarInt(this.deltaTime));a.push(255,c.Util.getType(this.subtype));switch(this.subtype){case "sequenceNumber":a.push(1,this.number);break;case "midiChannelPrefix":a.push(1,this.channel);break;case "setTempo":a.push(3,(this.microsecondsPerBeat&16711680)>>16,(this.microsecondsPerBeat&65280)>>8,this.microsecondsPerBeat&255);break;case "smpteOffset":a.push(5,this.hourByte,this.min,this.sec,this.frame,this.subframe);break;case "timeSignature":a.push(4,
this.numerator,Math.log(this.denominator)/Math.log(2),this.metronome,this.thirtyseconds);break;case "keySignature":a.push(2,this.key,this.scale);break;case "copyrightNotice":case "text":case "trackName":case "instrumentName":case "lyrics":case "marker":case "cuePoint":var b=this.text.split("");Array.prototype.push.apply(a,[b.length].concat(b));break;case "sequencerSpecific":case "unknown":a.push(1,this.data);break;case "endOfTrack":a.push(0)}return a}a=[];b=c.Util.getType(this.subtype);b=parseInt(b.toString(16)+
this.channel.toString(16),16);Array.prototype.push.apply(a,c.Util.writeVarInt(this.deltaTime));a.push(b);switch(this.subtype){case "noteOn":case "noteOff":a.push(this.noteNumber,this.velocity);break;case "noteAfterTouch":a.push(this.noteNumber,this.amount);break;case "controller":a.push(this.controllerType,this.value);break;case "programChange":byteArry.push(this.programNumber);break;case "channelAfterTouch":a.push(this.amount);break;case "pitchBend":a.push(this.course,this.fine)}return a},remove:function(){null!==
this.track&&this.track.removeEvent(this)}};c.Emitter&&c.Emitter.register(c.Event);return c}(jMID||{}),jMID=function(c){var a=function(b){for(var a,c=Array.prototype.slice.call(arguments,1),d=c.length,g;d&&this[b].length;)for(a=c[--d];-1!==(g=this[b].indexOf(a));)this[b].splice(g,1);return this};c.Track=function(b){this.events=[];this.notes=[];this.timing={MicroSPB:5E5,MSPQN:500,MSPT:500/960};for(var a in b)b.hasOwnProperty(a)&&(this[a]=b[a]);this.processNotes()};c.Track.prototype={pushEvent:function(b){this.events.push(b);
return this},pushNote:function(b){this.notes.push(b);return this},getEvents:function(b){return"undefined"!==typeof b?0<=b&&b<this.events.length?this.events[b]:null:this.events},getNotes:function(b){return"undefined"!==typeof b?0<=b&&b<this.notes.length?this.notes[b]:null:this.notes},removeEvents:function(){return a.apply(this,["events"].concat(Array.prototype.slice.call(arguments)))},removeNotes:function(){return a.apply(this,["notes"].concat(Array.prototype.slice.call(arguments)))},removeNote:function(b){a.call(this,
"notes",b)},removeEvent:function(b){var e=this.events.indexOf(b),e=this.events[e];a.call(this,"events",b);e&&this.calculateDelta(e)},cloneEvents:function(){return this.events.slice(0)},cloneNotes:function(){return this.notes.slice(0)},hasEvent:function(b){return-1!==this.events.indexOf(b)},hasNote:function(){return-1!==this.notes.indexOf(notes)},insertEventAtTime:function(b){var a=this.positionEvent(b);this.events[a+1]?this.calculateDelta(b,this.events[a+1]):this.calculateDelta(b)},insertNoteAtTime:function(b){this.positionNote(b)},
encode:function(){for(var b=[],a=0,h=0,d=this.events.length;h<d;h++){var g=this.getEvents(h).encode(),a=a+g.length;Array.prototype.push.apply(b,g)}a=c.Util.stringToBytes(a.toString(16),4);return c.Util.bytesToString([77,84,114,107].concat(a,b))},adjustEventTime:function(b,a){var b=c.Util.isNumber(b)?this.events[b]:b,h=this.events.indexOf(b),d=this.events[h+1];Math.round(a/this.timing.MSPT);b.time+=a;this.hasEvent(b)&&this.events.splice(h,1);h=this.positionEvent(b);this.calculateDelta(d,b,this.events[h+
1])},positionEvent:function(b){if(0===this.events.length)return this.events.splice(0,0,b),0;for(var a=0,c=this.events.length;a<c&&b.time>this.events[a].time;a++);this.events.splice(a,0,b);return a},positionNote:function(b){var a=this.notes.indexOf(b);-1!==a&&this.notes.splice(a,1);if(0===this.notes.length)return this.notes.splice(0,0,b),0;for(var a=0,c=this.notes.length;a<c&&b.start>this.notes[a].start;a++);this.notes.splice(a,0,b);return a},calculateDelta:function(){for(var a=Array.prototype.slice.call(arguments),
c=0,h=a.length;c<h;c++){var d=a[c];if(d){var g=this.events.indexOf(d),g=this.events[g-1];d.deltaTime=g?Math.round((d.time-g.time)/this.timing.MSPT):Math.round(d.time/this.timing.MSPT)}}},switchEvents:function(a,c){var h=this.events.indexOf(a),d=this.events.indexOf(c);this.events.splice(d,1,a);this.events.splice(h,1,c)},processNotes:function(){var a={};this.notes=[];for(var e=0,h=this.events.length;e<h;e++){var d=this.events[e];"noteOn"===d.subtype?a[d.noteNumber]=d:"noteOff"===d.subtype&&d.noteNumber in
a&&(new c.Note({noteOn:a[d.noteNumber],noteOff:d,track:this}),delete a[d.noteNumber])}},processChannelEventTimes:function(){for(var a=this.timing.MSPT,c=0,h=0,d=this.events.length;h<d;h++){var g=this.events[h],f=g.deltaTime*a;g.set("time",c+f);c+=f}}};c.Emitter&&c.Emitter.register(c.Track);return c}(jMID||{}),jMID=function(c){c.File=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.timeSignature={beatsPerBar:4,beatValue:4};this.timing={MicroSPB:5E5,MSPQN:500,MSPT:500/960};this.header||
(this.header={format:0,trackCount:1,ticksPerBeat:960});if(this.tracks){this.processMetaEvents();for(a=this.tracks.length-1;0<=a;a--)this.tracks[a].timing=this.timing;this.processChannelEventTimes();this.processNotes()}else this.tracks=[new c.Track],this.header.trackCount=1,this.calculateBPM()};c.File.prototype={processMetaEvents:function(){for(var a=c.Query(this).filter("type:meta").not("subtype:endOfTrack, subtype:trackName").toArray(),b=0,e=a.length;b<e;b++)switch(a[b].subtype){case "timeSignature":this.timeSignature.beatsPerBar=
a[b].numerator;this.timeSignature.beatValue=a[b].denominator;break;case "setTempo":this.timing.MicroSPB=a[b].microsecondsPerBeat}this.calculateBPM();this.timing.MSPQN=this.timing.MicroSPB/1E3;this.timing.MSPT=this.timing.MSPQN/this.header.ticksPerBeat},processChannelEventTimes:function(){for(var a=0,b=this.tracks.length;a<b;a++)this.tracks[a].processChannelEventTimes()},processNotes:function(){for(var a=0,b=this.tracks.length;a<b;a++)this.tracks[a].processNotes()},calculateBPM:function(){this.timing.BPM=
6E7/this.timing.MicroSPB*(this.timeSignature.beatValue/4)},createTrack:function(a){this.tracks.push(new c.Track(a))},removeTrack:function(a){this.tracks.splice(a,1)},getTrack:function(a){return this.tracks[a]},getHeader:function(){return this.header},encode:function(){return(new c.Encoder).encode(this)},base64Encode:function(){return btoa(this.encode())}};c.Emitter&&c.Emitter.register(c.File);return c}(jMID||{}),jMID=function(c){c.Note=function(a){this.track=null;this.length=0;a=a||{};this.noteOn=
a.noteOn?a.noteOn:new c.Event({type:"channel",subtype:"noteOn",deltaTime:0,time:a.time||0,velocity:a.velocity||90,noteNumber:a.noteNumber||32,track:a.track||null});this.noteOff=a.noteOff?a.noteOff:new c.Event({type:"channel",subtype:"noteOff",deltaTime:0,time:a.length?this.noteOn.time+a.length:this.noteOn.time+100,velocity:this.noteOn.velocity,noteNumber:this.noteOn.noteNumber,track:a.track||null});this.end=this.noteOff.time;this.start=this.noteOn.time;this.velocity=this.noteOn.velocity;this.noteNumber=
this.noteOn.noteNumber;this.length=this.noteOff.time-this.noteOn.time;a.track&&(this.track=a.track,this.track.hasEvent(this.noteOn)||this.track.insertEventAtTime(this.noteOn),this.track.hasEvent(this.noteOff)||this.track.insertEventAtTime(this.noteOff),this.track.insertNoteAtTime(this))};c.Note.prototype={adjustTime:function(a){this.track.adjustEventTime(this.noteOn,a);this.track.adjustEventTime(this.noteOff,a);this.track.positionNote(this)},adjustLength:function(a){this.track.adjustEventTime(this.noteOff,
a);this.length=this.noteOff.time-this.noteOn.time;this.end=this.noteOff.time},adjustNoteNumber:function(a){this.setNoteNumber(this.noteNumber+a)},setNoteNumber:function(a){this.noteOn.noteNumber=a;this.noteNumber=this.noteOff.noteNumber=a},setVelocity:function(a){this.velocity=this.noteOn.velocity=a},setChannel:function(a){c.Util.inRange(a,0,15)&&(this.noteOn.channel=a,this.channel=this.noteOff.channel=a)},remove:function(){null!==this.track&&(this.track.removeEvent(this.noteOn),this.track.removeEvent(this.noteOff),
this.track.removeNote(this))}};c.Emitter&&c.Emitter.register(c.Note);return c}(jMID||{}),jMID=function(c){c.Stream=function(a){this.index=0;this.string=a};c.Stream.prototype={read:function(a){var b=this.string.substr(this.index,a);this.index+=a;return b},readInt32:function(){var a=this.string,b=this.index,a=(a.charCodeAt(b)<<24)+(a.charCodeAt(b+1)<<16)+(a.charCodeAt(b+2)<<8)+a.charCodeAt(b+3);this.index+=4;return a},readInt16:function(){var a=this.string,b=this.index,a=(a.charCodeAt(b)<<8)+a.charCodeAt(b+
1);this.index+=2;return a},readInt8:function(a){var b=this.string.charCodeAt(this.index);this.index+=1;return a&&127<b?b-256:b},eof:function(){return this.index>=this.string.length},readVarInt:function(){for(var a=0;;){var b=this.readInt8();if(b&128)a+=b&127,a<<=7;else return a+b}}};c.Emitter&&c.Emitter.register(c.Stream);return c}(jMID||{}),jMID=function(){jMID.Encoder=function(){};jMID.Encoder.prototype={encode:function(c){for(var a="",b=c.getHeader(),e=jMID.Util,a=a+"MThd\x00\x00\x00\u0006"+(0===
b.format?"\x00\x00":"\x00\u0001"),a=a+e.bytesToString(e.stringToBytes(b.trackCount.toString(),2)),a=a+e.bytesToString([b.ticksPerBeat>>8,b.ticksPerBeat&255]),b=0,e=c.tracks.length;b<e;b++)var h=c.tracks[b].encode(),a=a+h;return a}};jMID.Emitter&&jMID.Emitter.register(jMID.Encoder);return jMID}(jMID||{}),jMID=function(c){var a=function(a,b){var d=new c.Event({track:b});d.set("deltaTime",a.readVarInt());var g=a.readInt8(),f=c.EventTypes;if(240==(g&240))switch(g){case f.META:d.set("type","meta");var i=
a.readInt8(),g=a.readVarInt(),f=c.SubEventTypes,l;for(l in f){var j=f[l];if(i==j){switch(j){case f.SEQUENCE_NUMBER:d.set("number",a.readInt16());break;case f.MIDI_CHANNEL_PREFIX:d.set("channel",a.readInt8());break;case f.SET_TEMPO:d.set("microsecondsPerBeat",(a.readInt8()<<16)+(a.readInt8()<<8)+a.readInt8());d.set("subtype","setTempo");break;case f.SMPTE_OFFSET:i=a.readInt8();d.set({hourByte:i,frameRate:{"0":24,32:25,64:29,96:30}[i&96],hour:i&31,min:a.readInt8(),sec:a.readInt8(),frame:a.readInt8(),
subframe:a.readInt8(),subtype:"smpteOffset"});break;case f.TIME_SIGNATURE:d.set({numerator:a.readInt8(),denominator:Math.pow(2,a.readInt8()),metronome:a.readInt8(),thirtyseconds:a.readInt8(),subtype:"timeSignature"});break;case f.KEY_SIGNATURE:d.set({key:a.readInt8(!0),scale:a.readInt8(),subtype:"keySignature"});break;case f.TEXT:d.set({subtype:"text",text:a.read(g)});break;case f.COPYRIGHT_NOTICE:d.set({subtype:"copyrightNotice",text:a.read(g)});break;case f.TRACK_NAME:d.set({subtype:"trackName",
text:a.read(g)});break;case f.INSTRUMENT_NAME:d.set({subtype:"instrumentName",text:a.read(g)});break;case f.LYRICS:d.set({subtype:"lyrics",text:a.read(g)});break;case f.MARKER:d.set({subtype:"marker",text:a.read(g)});break;case f.CUE_POINT:d.set({subtype:"cuePoint",text:a.read(g)});break;case f.END_OF_TRACK:d.set("subtype","endOfTrack");break;case f.SEQUENCER_SPECIFIC:d.set({subtype:"sequencerSpecific",data:a.read(g)});break;default:d.set({subtype:"unknown",data:a.read(g)})}break}}break;case f.SYSEX:d.set("type",
"sysex");i=a.readVarInt();d.set("data",a.read(i));break;case f.DIVIDED_SYSEX:event.set("type","dividedSysex");i=stream.readVarInt();event.set("data",stream.read(i));break;default:throw Error("Unrecognized event");}else for(i in j=g,g=c.SubEventTypes,0==(j&128)?(l=j,j=this._lastEventType):(l=a.readInt8(),this._lastEventType=j),f=j>>4,d.set("channel",j&15),d.set("type","channel"),g)if(j=g[i],f==j)switch(j){case g.NOTE_OFF:d.set("noteNumber",l);d.set("subtype","noteOff");d.set("velocity",a.readInt8());
break;case g.NOTE_ON:d.set("noteNumber",l);d.set("subtype","noteOn");d.set("velocity",a.readInt8());0==d.get("velocity")&&d.set("subtype","noteOff");break;case g.NOTE_AFTER_TOUCH:d.set("noteNumber",l);d.set("subtype","noteAfterTouch");d.set("amount",a.readInt8());break;case g.CONTROLLER:d.set("subtype","controller");d.set("controllerType",l);d.set("value",a.readInt8());break;case g.PROGRAM_CHANGE:d.set("subtype","programChange");d.set("programNumber",l);break;case g.CHANNEL_AFTER_TOUCH:d.set("subtype",
"channelAfterTouch");d.set("amount",l);break;case g.PITCH_BEND:d.set("subtype","pitchBend"),d.set("coarse",l),d.set("fine",a.readInt8()),d.set("value",d.coarse+(d.fine<<7))}return d},b=function(a){var b=a.read(4),c=a.readInt32();return{id:b,length:c,data:a.read(c)}};c.Decoder=function(){};c.Decoder.prototype={decode:function(e){for(var h=b(e),d=new c.Stream(h.data),g=d.readInt16(),h=d.readInt16(),f=d.readInt16(),d=[],g={format:g,trackCount:h,ticksPerBeat:f},f=0;f<h;f++){d[f]=new c.Track;for(var i=
b(e),i=new c.Stream(i.data);!i.eof();)d[f].pushEvent(a.call(this,i,d[f]))}return new c.File({header:g,tracks:d})}};c.Emitter&&c.Emitter.register(c.Decoder);return c}(jMID||{}),jMID=function(c){var a=function(a){var b;if(a){b=a.split(",").map(function(a){return a.trim()});for(var d=[],e=0,h=b.length;e<h;e++)d.push(b[e].split(" "));b=d}else b=void 0;d=[];e=0;for(h=this._results.tracks.length;e<h;e++){var n=this._results.tracks[e];d.push(new c.Track({timing:n.timing}));var m=this.noteSearch?n.getNotes():
n.getEvents();if(a)for(var s=0,m=m.length;s<m;s++)for(var p=this.noteSearch?n.getNotes(s):n.getEvents(s),q=!0,u=0,w=b.length;u<w;u++){for(var v=b[u],t=0,x=v.length;t<x;t++){var r;a:{r=v[t];for(var o=[":",">",">=","<","<="],k=o.length-1;0<=k;k--)if(-1!==r.search(o[k])){r=o[k];break a}r=void 0}k=v[t].split(r);o=k[0];k=k[1];switch(r){case ":":q=p[o]==k;break;case ">":q=p[o]>k;break;case ">=":q=p[o]>=k;break;case "<":q=p[o]<k;break;case "<=":q=p[o]<=k}if(!q)break}q&&(this.noteSearch?d[e].pushNote(p):
d[e].pushEvent(p))}else d[e]=n}return{tracks:d}},b=function(a,b,c){this.noteSearch=c;this._results=b?b:{tracks:a.tracks.slice(0)};this._file=a};b.prototype={filter:function(c){c=a.call(this,c);return new b(this._file,c,this.noteSearch)},not:function(d){for(var d=a.call(this,d),f=this._results,e=[],h=0,j=f.tracks.length;h<j;h++){var n=f.tracks[h],m=new c.Track;this.noteSearch?(m.notes=n.cloneNotes(),m.removeNotes.apply(m,d.tracks[h].getNotes())):(m.events=n.cloneEvents(),m.removeEvents.apply(m,d.tracks[h].getEvents()));
e.push(m)}return new b(this._file,{tracks:e},this.noteSearch)},toArray:function(){for(var a=[],b=0,c=this._results.tracks.length;b<c;b++)var d=this._results.tracks[b],a=a.concat(this.noteSearch?d.notes:d.events);return a},increment:function(a,b){c.Util[this.noteSearch?"forAllNotes":"forAllEvents"](this._results.tracks,function(c){a in c&&(c[a]+=b)});return this},set:function(a,b){c.Util[this.noteSearch?"forAllNotes":"forAllEvents"](this._results.tracks,function(c){a in c&&(c[a]=b)});return this},
get:function(a,b){return this._results.tracks[a].events[b]},eq:function(a,d){return new b(this._file,{tracks:[new c.Track({events:[this.get.apply(this,arguments)],timing:a.timing})]})},encodeEvents:function(a){var b=[];c.Util.forAllEvents(this._results.tracks,function(d,e,h){b[h]||(b[h]=[]);b[h].push(!a?c.Util.bytesToString(d.encode()):d.encode())});return b},encodeTracks:function(a){var b=[];c.Util.forEachTrack(this._results.tracks,function(d,e){b[e]||(b[e]=[]);b[e].push(!a?d.encode():c.Util.stringToBytes(d.encode()))});
return b},notes:function(c){this.noteSearch=!0;c=a.call(this,c);return new b(this._file,c,!0)},remove:function(){c.Util[this.noteSearch?"forAllNotes":"forAllEvents"](this._results.tracks,function(a){a.remove()});return new b(this._file,{tracks:this._file.tracks.slice(0)},this.noteSearch)},apply:function(){if(this.noteSearch)return this;for(var a=0,d=this._results.tracks.length;a<d;a++)this._file.tracks[a]=new c.Track({events:this._results.tracks[a].cloneEvents(),timing:this._file.tracks[a].timing});
return new b(this._file)}};for(var e="adjustNoteNumber adjustTime adjustLength setNotNumber setVelocity setChannel".split(" "),h=0,d=e.length;h<d;h++)(function(a){b.prototype[a]=function(b){if(!this.noteSearch)return this;c.Util.forAllNotes(this._results.tracks,function(c){c[a](b)});return this}})(e[h]);c.Query=function(a){if(!a&&!a instanceof c.File)throw Error("jMID.File is needed for querying");return new b(a)};c.Emitter&&c.Emitter.register(c.Query);return c}(jMID||{}),jMID=function(c){var a="C ;C#;D ;D#;E ;F ;F#;G ;G#;A ;A#;B ".split(";");
c.Converter=function(){this.setType(c.Converter.Types.NOTE_TO_FREQUENCY)};c.Converter.prototype={noteToFrequency:function(a){return 0<=a&&119>=a?440*Math.pow(2,(a-69)/12):-1},noteToName:function(b){return 0<=b&&119>=b?(a[b%12]+Math.round(b/12).toString()).replace(/\s+/g,""):"---"},frequencyToNote:function(a){return Math.round(12*(Math.log(a/440)/Math.log(2)))+69},nameToNote:function(b){var c,h,d;if(2===b.length)h=b[0]+" "+b[1];else if(2<b.length)return-1;h.toUpperCase();b=-1;c=0;for(d=a.length;c<
d;c++)if(a[c]===h[0]+h[1]){b=c;break}try{return c=parseInt(h[2],10),12*c+b}catch(g){return-1}},convert:function(a){switch(this._type){case 0:return this.noteToFrequency(a);case 1:return this.noteToName(a);case 2:return this.frequencyToNote(a);case 3:return this.nameToNote(a)}},setType:function(a){this._type=a}};c.Converter.Types={NOTE_TO_FREQUENCY:0,NOTE_TO_NAME:1,FREQUENCY_TO_NOTE:2,NAME_TO_NOTE:3};c.Emitter&&c.Emitter.register(c.Converter);return c}(jMID||{});
