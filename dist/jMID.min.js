var jMID=function(e){e.Util={isObject:function(b){return b===Object(b)},asciiToHex:function(b){for(var c="",a=0,f=b.length;a<f;a++)c+=b.charCodeAt(a).toString(16);return c},hexToAscii:function(b){for(var c="",a=0,f=b.length;a<f;a++)c+=String.fromCharCode(parseInt(b.substr(a,2),16)),b[a];return c},hexToBinary:function(b){return b.toString(2)}};for(var d="Arguments Function String Number Date RegExp".split(" "),a=d.length-1;0<=a;a--)(function(b){e.Util["is"+b]=function(c){return toString.call(c)=="[object "+
b+"]"}})(d[a]);return e}(jMID||{}),jMID=function(e){var d;e.Event=function(){d=e.Util};e.Event.prototype={set:function(){var a=arguments;if(d.isObject(a[0]))for(var b in a[0])a[0].hasOwnProperty(b)&&(this[b]=a[0][b]);else if(d.isString(a[0]))this[a[0]]=a[1];else return null},get:function(a){return this[a]}};return e}(jMID||{}),jMID=function(e){e.Stream=function(d){this.index=0;this.string=d};e.Stream.prototype={read:function(d){var a=this.string.substr(this.index,d);this.index+=d;return a},readInt32:function(){var d=
this.string,a=this.index,d=(d.charCodeAt(a)<<24)+(d.charCodeAt(a+1)<<16)+(d.charCodeAt(a+2)<<8)+d.charCodeAt(a+3);this.index+=4;return d},readInt16:function(){var d=this.string,a=this.index,d=(d.charCodeAt(a)<<8)+d.charCodeAt(a+1);this.index+=2;return d},readInt8:function(d){var a=this.string.charCodeAt(this.index);this.index+=1;return d&&127<a?a-256:a},eof:function(){return this.index>=this.string.length},readVarInt:function(){for(var d=0;;){var a=this.readInt8();if(a&128)d+=a&127,d<<=7;else return d+
a}}};return e}(jMID||{}),jMID=function(e){e.File=function(d){for(var a in d)d.hasOwnProperty(a)&&(this[a]=d[a])};e.File.prototype={};return e}(jMID||{}),jMID=function(e){var d=function(b){var c=new e.Event;c.set("time",b.readVarInt());var a=b.readInt8(),f=e.Decoder.EventTypes;if(240==(a&240))switch(a){case f.META:c.set("type","meta");var d=b.readInt8(),a=b.readVarInt(),f=e.Decoder.SubEventTypes,g;for(g in f){var h=f[g];if(d==h){switch(h){case f.SEQUENCE_NUMBER:c.set("number",b.readInt16());break;
case f.MIDI_CHANNEL_PREFIX:c.set("channel",b.readInt8());break;case f.SET_TEMPO:c.set("microsecondsPreBeat",(b.readInt8()<<16)+(b.readInt8()<<8)+b.readInt8());c.set("subtype","setTempo");break;case f.SMPTE_OFFSET:d=b.readInt8();c.set({frameRate:{"0":24,32:25,64:29,96:30}[hourByte&96],hour:d&31,min:b.readInt8(),sec:b.readInt8(),frame:b.readInt8(),subframe:b.readInt8(),subtype:"smpteOffset"});break;case f.TIME_SIGNATURE:c.set({numerator:b.readInt8(),denominator:Math.pow(2,b.readInt8()),metronome:b.readInt8(),
thirtyseconds:b.readInt8(),subtype:"timeSignature"});break;case f.KEY_SIGNATURE:c.set({key:b.readInt8(!0),scale:b.readInt8(),subtype:"keySignature"});break;case f.TEXT:c.set({subtype:"text",text:b.read(a)});break;case f.COPYRIGHT_NOTICE:c.set({subtype:"copyrightNotice",text:b.read(a)});break;case f.TRACK_NAME:c.set({subtype:"trackName",text:b.read(a)});break;case f.INSTRUMENT_NAME:c.set({subtype:"instrumentName",text:b.read(a)});break;case f.LYRICS:c.set({subtype:"lyrics",text:b.read(a)});break;case f.MARKER:c.set({subtype:"marker",
text:b.read(a)});break;case f.CUE_POINT:c.set({subtype:"cuePoint",text:b.read(a)});break;case f.END_OF_TRACK:c.set("subtype","endOfTrack");break;case f.SEQUENCER_SPECIFIC:c.set({subtype:"sequencerSpecific",data:b.read(a)});break;default:c.set({subtype:"unknown",data:b.read(a)})}break}}break;case f.SYSEX:c.set("type","sysex");d=b.readVarInt();c.set("data",b.read(d));break;case f.DIVIDED_SYSEX:event.set("type","dividedSysex");b=stream.readVarInt();event.set("data",stream.read(b));break;default:throw Error("Unrecognized event");
}else for(d in h=a,a=e.Decoder.SubEventTypes,0==(h&128)?(g=h,h=this._lastEventType):(g=b.readInt8(),this._lastEventType=h),f=h>>4,c.set("channel",h&15),c.set("type","channel"),a)if(h=a[d],f==h)switch(h){case a.NOTE_OFF:c.set("noteNumber",g);c.set("subtype","noteOff");c.set("velocity",b.readInt8());break;case a.NOTE_ON:c.set("noteNumber",g);c.set("subtype","noteOn");c.set("velocity",b.readInt8());0==c.get("velocity")&&c.set("subtype","noteOff");break;case a.NOTE_AFTER_TOUCH:c.set("noteNumber",g);c.set("subtype",
"noteAfterTouch");c.set("amount",b.readInt8());break;case a.CONTROLLER:c.set("subtype","controller");c.set("controllerType",g);c.set("value",b.readInt8());break;case a.PROGRAM_CHANGE:c.set("subtype","programChange");c.set("programNumber",g);break;case a.CHANNEL_AFTER_TOUCH:c.set("subtype","channelAfterTouch");c.set("amount",g);break;case a.PITCH_BEND:c.set("subtype","pitchBend"),c.set("value",g+(b.readInt8()<<7))}return c},a=function(a){var c=a.read(4),d=a.readInt32();return{id:c,length:d,data:a.read(d)}};
e.Decoder=function(){};e.Decoder.prototype={decode:function(b){for(var c=a(b),l=new e.Stream(c.data),f=l.readInt16(),c=l.readInt16(),k=l.readInt16(),l=[],f={format:f,trackCount:c,ticksPerBeat:k},k=0;k<c;k++){l[k]=[];for(var g=a(b),g=new e.Stream(g.data);!g.eof();)l[k].push(d.call(this,g))}return new e.File({header:f,tracks:l})}};e.Decoder.EventTypes={META:255,SYSEX:240,DIVIDED_SYSEX:247};e.Decoder.SubEventTypes={SEQUENCE_NUMBER:0,TEXT:1,COPYRIGHT_NOTICE:2,TRACK_NAME:3,INSTRUMENT_NAME:4,LYRICS:5,MARKER:6,
CUE_POINT:7,MIDI_CHANNEL_PREFIX:32,END_OF_TRACK:47,SET_TEMPO:81,SMPTE_OFFSET:84,TIME_SIGNATURE:88,KEY_SIGNATURE:89,SEQUENCER_SPECIFIC:127,NOTE_OFF:8,NOTE_ON:9,NOTE_AFTER_TOUCH:10,CONTROLLER:11,PROGRAM_CHANGE:12,CHANNEL_AFTER_TOUCH:13,PITCH_BEND:14};return e}(jMID||{}),jMID=function(e){var d=function(){for(var a=this.slice(0),b,d=arguments,e=d.length,g;e&&a.length;)for(b=d[--e];-1!==(g=a.indexOf(b));)a.splice(g,1);return a},a=function(a){for(var b=a.split(",").map(function(a){return a.trim()}),a=[],
d=0,e=b.length;d<e;d++)a.push(b[d].split(" "));b=[];d=0;for(e=this._results.tracks.length;d<e;d++){var g=this._results.tracks[d];b.push([]);for(var h=0,s=g.length;h<s;h++)for(var n=g[h],m=!1,q=0,t=a.length;q<t;q++){for(var r=a[q],p=0,u=r.length;p<u;p++){var o;a:{o=r[p];for(var j=[":",">",">=","<","<="],i=j.length-1;0<=i;i--)if(-1!==o.search(j[i])){o=j[i];break a}o=void 0}i=r[p].split(o);j=i[0];i=i[1];switch(o){case ":":m=n[j]==i;break;case ">":m=n[j]>i;break;case ">=":m=n[j]>=i;break;case "<":m=n[j]<
i;break;case "<=":m=n[j]<=i}if(!m)break}m&&b[d].push(n)}}return{tracks:b}},b=function(a,b){this._results=b?b:{tracks:a.tracks.slice(0)};this._file=a};b.prototype={filter:function(c){c=a.call(this,c);return new b(this._file,c)},not:function(c){for(var c=c?a.call(this,c):this._results,e=[],f=0,k=c.tracks.length;f<k;f++)e.push(d.apply(this._results.tracks[f],c.tracks[f]));return new b(this._file,{tracks:e})},apply:function(){for(var a=0,d=this._results.tracks.length;a<d;a++)this._file.tracks[a]=this._results.tracks[a].slice(0);
return new b(this._file)}};e.Query=function(a){if(!a)throw Error("jMID.File is needed for querying");return new b(a)};return e}(jMID||{}),jMID=function(e){var d="C ;C#;D ;D#;E ;F ;F#;G ;G#;A ;A#;B ".split(";");e.Converter=function(){this.setType(e.Converter.Types.NOTE_TO_FREQUENCY)};e.Converter.prototype={noteToFrequency:function(a){return 0<=a&&119>=a?440*Math.pow(2,(a-69)/12):-1},noteToName:function(a){return 0<=a&&119>=a?(d[a%12]+Math.round(a/12).toString()).replace(/\s+/g,""):"---"},frequencyToNote:function(a){return Math.round(12*
(Math.log(a/440)/Math.log(2)))+69},nameToNote:function(a){var b,c,e;if(2===a.length)c=a[0]+" "+a[1];else if(2<a.length)return-1;c.toUpperCase();a=-1;b=0;for(e=d.length;b<e;b++)if(d[b]===c[0]+c[1]){a=b;break}try{return b=parseInt(c[2],10),12*b+a}catch(f){return-1}},convert:function(a){switch(this._type){case 0:return this.noteToFrequency(a);case 1:return this.noteToName(a);case 2:return this.frequencyToNote(a);case 3:return this.nameToNote(a)}},setType:function(a){this._type=a}};e.Converter.Types=
{NOTE_TO_FREQUENCY:0,NOTE_TO_NAME:1,FREQUENCY_TO_NOTE:2,NAME_TO_NOTE:3};return e}(jMID||{});
