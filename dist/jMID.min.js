var jMID=function(e){e.Util={isObject:function(c){return c===Object(c)},asciiToHex:function(c){for(var d="",b=0,a=c.length;b<a;b++)d+=c.charCodeAt(b).toString(16);return d},hexToAscii:function(c){console.log(c);for(var d="",b=0,a=c.length;b<a;b++)d+=String.fromCharCode(parseInt(c.substr(b,2),16)),c[b];return d},hexToBinary:function(c){return c.toString(2)},bytesToString:function(c){for(var d="",b=0,a=c.length;b<a;b++)d=e.Util.isString(c[b])?d+c[b]:d+String.fromCharCode(c[b]);return d},stringToBytes:function(c,
d){if(d)for(;c.length/2<d;)c="0"+c;for(var b=[],a=c.length-1;0<=a;a-=2)b.unshift(parseInt(0===a?c[a]:c[a-1]+c[a],16));return b},writeVarInt:function(c){for(var d=c&127;c>>=7;)d<<=8,d|=c&127|128;for(c=[];;)if(c.push(d&255),d&128)d>>=8;else break;return c},getType:function(c){var d=e.SubEventTypes;switch(c){case "sequenceNumber":return d.SEQUENCER_NUMBER;case "text":return d.TEXT;case "copyrightNotice":return d.COPYRIGHT_NOTICE;case "trackName":return d.TRACK_NAME;case "instrumentName":return d.INSTRUMENT_NAME;
case "lyrics":return d.LYRICS;case "marker":return d.MARKER;case "cuePoint":return d.CUE_POINT;case "midiChannelPrefix":return d.MIDI_CHANNEL_PREFIX;case "endOfTrack":return d.END_OF_TRACK;case "setTempo":return d.SET_TEMPO;case "smpteOffset":return d.SMPTE_OFFSET;case "timeSignature":return d.TIME_SIGNATURE;case "sequencerSpecific":return d.SEQUENCER_SPECIFIC;case "noteOff":return d.NOTE_OFF;case "noteOn":return d.NOTE_ON;case "noteAfterTouch":return d.NOTE_AFTER_TOUCH;case "controller":return d.CONTROLLER;
case "programChange":return d.PROGRAM_CHANGE;case "channelAfterTouch":return d.CHANNEL_AFTER_TOUCH;case "pitchBend":return d.PITCH_BEND}}};for(var a="Arguments Function String Number Date RegExp".split(" "),b=a.length-1;0<=b;b--)(function(c){e.Util["is"+c]=function(d){return toString.call(d)=="[object "+c+"]"}})(a[b]);return e}(jMID||{}),jMID=function(e){e.EventTypes={META:255,SYSEX:240,DIVIDED_SYSEX:247};e.SubEventTypes={SEQUENCE_NUMBER:0,TEXT:1,COPYRIGHT_NOTICE:2,TRACK_NAME:3,INSTRUMENT_NAME:4,
LYRICS:5,MARKER:6,CUE_POINT:7,MIDI_CHANNEL_PREFIX:32,END_OF_TRACK:47,SET_TEMPO:81,SMPTE_OFFSET:84,TIME_SIGNATURE:88,KEY_SIGNATURE:89,SEQUENCER_SPECIFIC:127,NOTE_OFF:8,NOTE_ON:9,NOTE_AFTER_TOUCH:10,CONTROLLER:11,PROGRAM_CHANGE:12,CHANNEL_AFTER_TOUCH:13,PITCH_BEND:14};return e}(jMID||{}),jMID=function(e){e.Event=function(){};e.Event.prototype={set:function(){var a=e.Util,b=arguments;if(a.isObject(b[0]))for(var c in b[0])b[0].hasOwnProperty(c)&&(this[c]=b[0][c]);else if(a.isString(b[0]))this[b[0]]=b[1];
else return null},get:function(a){return this[a]},encode:function(){if("meta"===this.type){var a=[this.time,255,e.Util.getType(this.subtype)];switch(this.subtype){case "sequenceNumber":a.push(1,this.number);break;case "midiChannelPrefix":a.push(1,this.channel);break;case "setTempo":a.push(3,(this.microsecondsPerBeat&16711680)>>16,(this.microsecondsPerBeat&65280)>>8,this.microsecondsPerBeat&255);break;case "smpteOffset":a.push(5,this.hourByte,this.min,this.sec,this.frame,this.subframe);break;case "timeSignature":a.push(4,
this.numerator,Math.log(this.denominator)/Math.log(2),this.metronome,this.thirtyseconds);break;case "keySignature":a.push(2,this.key,this.scale);break;case "copyrightNotice":case "text":case "trackName":case "instrumentName":case "lyrics":case "marker":case "cuePoint":var b=this.text.split("");Array.prototype.push.apply(a,[b.length].concat(b));break;case "sequencerSpecific":case "unknown":a.push(1,this.data);break;case "endOfTrack":a.push(0)}return a}a=[];b=e.Util.getType(this.subtype);b=parseInt(b.toString(16)+
this.channel.toString(16),16);Array.prototype.push.apply(a,e.Util.writeVarInt(this.time));a.push(b);switch(this.subtype){case "noteOn":case "noteOff":a.push(this.noteNumber,this.velocity);break;case "noteAfterTouch":a.push(this.noteNumber,this.amount);break;case "controller":a.push(this.controllerType,this.value);break;case "programChange":byteArry.push(this.programNumber);break;case "channelAfterTouch":a.push(this.amount);break;case "pitchBend":a.push(this.course,this.fine)}return a}};return e}(jMID||
{}),jMID=function(e){e.Track=function(a){this.events=a||[]};e.Track.prototype={pushEvent:function(a){this.events.push(a);return this},getEvents:function(a){return"undefined"!==typeof a?0<=a&&a<this.events.length?this.events[a]:null:this.events},removeEvents:function(){for(var a,b=arguments,c=b.length,d;c&&this.events.length;)for(a=b[--c];-1!==(d=this.events.indexOf(a));)this.events.splice(d,1);return this},cloneEvents:function(){return this.events.slice(0)},encode:function(){for(var a=[],b=0,c=0,
d=this.events.length;c<d;c++){var h=this.getEvents(c).encode(),b=b+h.length;Array.prototype.push.apply(a,h)}b=e.Util.stringToBytes(b.toString(16),4);return e.Util.bytesToString([77,84,114,107].concat(b,a))}};return e}(jMID||{}),jMID=function(e){e.Stream=function(a){this.index=0;this.string=a};e.Stream.prototype={read:function(a){var b=this.string.substr(this.index,a);this.index+=a;return b},readInt32:function(){var a=this.string,b=this.index,a=(a.charCodeAt(b)<<24)+(a.charCodeAt(b+1)<<16)+(a.charCodeAt(b+
2)<<8)+a.charCodeAt(b+3);this.index+=4;return a},readInt16:function(){var a=this.string,b=this.index,a=(a.charCodeAt(b)<<8)+a.charCodeAt(b+1);this.index+=2;return a},readInt8:function(a){var b=this.string.charCodeAt(this.index);this.index+=1;return a&&127<b?b-256:b},eof:function(){return this.index>=this.string.length},readVarInt:function(){for(var a=0;;){var b=this.readInt8();if(b&128)a+=b&127,a<<=7;else return a+b}}};return e}(jMID||{}),jMID=function(e){e.File=function(a){for(var b in a)a.hasOwnProperty(b)&&
(this[b]=a[b])};e.File.prototype={getHeader:function(){return this.header}};return e}(jMID||{}),jMID=function(){jMID.Encoder=function(){};jMID.Encoder.prototype={encode:function(e){for(var a="",b=e.getHeader(),c=jMID.Util,a=a+"MThd\x00\x00\x00\u0006\x00\x00"+c.bytesToString(c.stringToBytes(b.trackCount.toString(),2)),a=a+c.bytesToString([b.ticksPerBeat>>8,b.ticksPerBeat&255]),b=0,c=e.tracks.length;b<c;b++)var d=e.tracks[b].encode(),a=a+d;return a}};jMID.Encoder.Notes={G9:127,Gb9:126,F9:125,E9:124,
Eb9:123,D9:122,Db9:121,C9:120,B8:119,Bb8:118,A8:117,Ab8:116,G8:115,Gb8:114,F8:113,E8:112,Eb8:111,D8:110,Db8:109,C8:108,B7:107,Bb7:106,A7:105,Ab7:104,G7:103,Gb7:102,F7:101,E7:100,Eb7:99,D7:98,Db7:97,C7:96,B6:95,Bb6:94,A6:93,Ab6:92,G6:91,Gb6:90,F6:89,E6:88,Eb6:87,D6:86,Db6:85,C6:84,B5:83,Bb5:82,A5:81,Ab5:80,G5:79,Gb5:78,F5:77,E5:76,Eb5:75,D5:74,Db5:73,C5:72,B4:71,Bb4:70,A4:69,Ab4:68,G4:67,Gb4:66,F4:65,E4:64,Eb4:63,D4:62,Db4:61,C4:60,B3:59,Bb3:58,A3:57,Ab3:56,G3:55,Gb3:54,F3:53,E3:52,Eb3:51,D3:50,Db3:49,
C3:48,B2:47,Bb2:46,A2:45,Ab2:44,G2:43,Gb2:42,F2:41,E2:40,Eb2:39,D2:38,Db2:37,C2:36,B1:35,Bb1:34,A1:33,Ab1:32,G1:31,Gb1:30,F1:29,E1:28,Eb1:27,D1:26,Db1:25,C1:24,B0:23,Bb0:22,A0:21,Ab0:20,G0:19,Gb0:18,F0:17,E0:16,Eb0:15,D0:14,Db0:13,C0:12};return jMID}(jMID||{}),jMID=function(e){var a=function(c){var d=new e.Event;d.set("time",c.readVarInt());var b=c.readInt8(),a=e.EventTypes;if(240==(b&240))switch(b){case a.META:d.set("type","meta");var f=c.readInt8(),b=c.readVarInt(),a=e.SubEventTypes,g;for(g in a){var i=
a[g];if(f==i){switch(i){case a.SEQUENCE_NUMBER:d.set("number",c.readInt16());break;case a.MIDI_CHANNEL_PREFIX:d.set("channel",c.readInt8());break;case a.SET_TEMPO:d.set("microsecondsPerBeat",(c.readInt8()<<16)+(c.readInt8()<<8)+c.readInt8());d.set("subtype","setTempo");break;case a.SMPTE_OFFSET:f=c.readInt8();d.set({hourByte:f,frameRate:{"0":24,32:25,64:29,96:30}[f&96],hour:f&31,min:c.readInt8(),sec:c.readInt8(),frame:c.readInt8(),subframe:c.readInt8(),subtype:"smpteOffset"});break;case a.TIME_SIGNATURE:d.set({numerator:c.readInt8(),
denominator:Math.pow(2,c.readInt8()),metronome:c.readInt8(),thirtyseconds:c.readInt8(),subtype:"timeSignature"});break;case a.KEY_SIGNATURE:d.set({key:c.readInt8(!0),scale:c.readInt8(),subtype:"keySignature"});break;case a.TEXT:d.set({subtype:"text",text:c.read(b)});break;case a.COPYRIGHT_NOTICE:d.set({subtype:"copyrightNotice",text:c.read(b)});break;case a.TRACK_NAME:d.set({subtype:"trackName",text:c.read(b)});break;case a.INSTRUMENT_NAME:d.set({subtype:"instrumentName",text:c.read(b)});break;case a.LYRICS:d.set({subtype:"lyrics",
text:c.read(b)});break;case a.MARKER:d.set({subtype:"marker",text:c.read(b)});break;case a.CUE_POINT:d.set({subtype:"cuePoint",text:c.read(b)});break;case a.END_OF_TRACK:d.set("subtype","endOfTrack");break;case a.SEQUENCER_SPECIFIC:d.set({subtype:"sequencerSpecific",data:c.read(b)});break;default:d.set({subtype:"unknown",data:c.read(b)})}break}}break;case a.SYSEX:d.set("type","sysex");f=c.readVarInt();d.set("data",c.read(f));break;case a.DIVIDED_SYSEX:event.set("type","dividedSysex");c=stream.readVarInt();
event.set("data",stream.read(c));break;default:throw Error("Unrecognized event");}else for(f in i=b,b=e.SubEventTypes,0==(i&128)?(g=i,i=this._lastEventType):(g=c.readInt8(),this._lastEventType=i),a=i>>4,d.set("channel",i&15),d.set("type","channel"),b)if(i=b[f],a==i)switch(i){case b.NOTE_OFF:d.set("noteNumber",g);d.set("subtype","noteOff");d.set("velocity",c.readInt8());break;case b.NOTE_ON:d.set("noteNumber",g);d.set("subtype","noteOn");d.set("velocity",c.readInt8());0==d.get("velocity")&&d.set("subtype",
"noteOff");break;case b.NOTE_AFTER_TOUCH:d.set("noteNumber",g);d.set("subtype","noteAfterTouch");d.set("amount",c.readInt8());break;case b.CONTROLLER:d.set("subtype","controller");d.set("controllerType",g);d.set("value",c.readInt8());break;case b.PROGRAM_CHANGE:d.set("subtype","programChange");d.set("programNumber",g);break;case b.CHANNEL_AFTER_TOUCH:d.set("subtype","channelAfterTouch");d.set("amount",g);break;case b.PITCH_BEND:d.set("subtype","pitchBend"),d.set("coarse",g),d.set("fine",c.readInt8()),
d.set("value",d.coarse+(d.fine<<7))}return d},b=function(c){var b=c.read(4),a=c.readInt32();return{id:b,length:a,data:c.read(a)}};e.Decoder=function(){};e.Decoder.prototype={decode:function(c){for(var d=b(c),h=new e.Stream(d.data),k=h.readInt16(),d=h.readInt16(),f=h.readInt16(),h=[],k={format:k,trackCount:d,ticksPerBeat:f},f=0;f<d;f++){h[f]=new e.Track;for(var g=b(c),g=new e.Stream(g.data);!g.eof();)h[f].pushEvent(a.call(this,g))}return new e.File({header:k,tracks:h})}};return e}(jMID||{}),jMID=function(e){var a=
function(c){for(var b=c.split(",").map(function(b){return b.trim()}),c=[],a=0,k=b.length;a<k;a++)c.push(b[a].split(" "));b=[];a=0;for(k=this._results.tracks.length;a<k;a++){var f=this._results.tracks[a];b.push(new e.Track);for(var g=0,i=f.getEvents().length;g<i;g++)for(var n=f.getEvents(g),m=!1,q=0,s=c.length;q<s;q++){for(var r=c[q],p=0,t=r.length;p<t;p++){var o;a:{o=r[p];for(var l=[":",">",">=","<","<="],j=l.length-1;0<=j;j--)if(-1!==o.search(l[j])){o=l[j];break a}o=void 0}j=r[p].split(o);l=j[0];
j=j[1];switch(o){case ":":m=n[l]==j;break;case ">":m=n[l]>j;break;case ">=":m=n[l]>=j;break;case "<":m=n[l]<j;break;case "<=":m=n[l]<=j}if(!m)break}m&&b[a].pushEvent(n)}}return{tracks:b}},b=function(b,a){this._results=a?a:{tracks:b.tracks.slice(0)};this._file=b};b.prototype={filter:function(c){c=a.call(this,c);return new b(this._file,c)},not:function(c){for(var c=c?a.call(this,c):this._results,d=[],h=0,k=c.tracks.length;h<k;h++){var f=new e.Track(c.tracks[h].cloneEvents());f.removeEvents.apply(f,
this._results.tracks[h].getEvents());d.push(f)}return new b(this._file,{tracks:d})},apply:function(){for(var a=0,d=this._results.tracks.length;a<d;a++)this._file.tracks[a]=new e.Track(this._results.tracks[a].cloneEvents());return new b(this._file)}};e.Query=function(a){if(!a)throw Error("jMID.File is needed for querying");return new b(a)};return e}(jMID||{}),jMID=function(e){var a="C ;C#;D ;D#;E ;F ;F#;G ;G#;A ;A#;B ".split(";");e.Converter=function(){this.setType(e.Converter.Types.NOTE_TO_FREQUENCY)};
e.Converter.prototype={noteToFrequency:function(a){return 0<=a&&119>=a?440*Math.pow(2,(a-69)/12):-1},noteToName:function(b){return 0<=b&&119>=b?(a[b%12]+Math.round(b/12).toString()).replace(/\s+/g,""):"---"},frequencyToNote:function(a){return Math.round(12*(Math.log(a/440)/Math.log(2)))+69},nameToNote:function(b){var c,d,e;if(2===b.length)d=b[0]+" "+b[1];else if(2<b.length)return-1;d.toUpperCase();b=-1;c=0;for(e=a.length;c<e;c++)if(a[c]===d[0]+d[1]){b=c;break}try{return c=parseInt(d[2],10),12*c+b}catch(k){return-1}},
convert:function(a){switch(this._type){case 0:return this.noteToFrequency(a);case 1:return this.noteToName(a);case 2:return this.frequencyToNote(a);case 3:return this.nameToNote(a)}},setType:function(a){this._type=a}};e.Converter.Types={NOTE_TO_FREQUENCY:0,NOTE_TO_NAME:1,FREQUENCY_TO_NOTE:2,NAME_TO_NOTE:3};return e}(jMID||{});
