var jMID=function(e){var c="C ;C#;D ;D#;E ;F ;F#;G ;G#;A ;A#;B ".split(";");e.Converter=function(){this.setType(e.Converter.Types.NOTE_TO_FREQUENCY)};e.Converter.prototype={noteToFrequency:function(a){return 0<=a&&119>=a?440*Math.pow(2,(a-69)/12):-1},noteToName:function(a){return 0<=a&&119>=a?(c[a%12]+Math.round(a/12).toString()).replace(/\s+/g,""):"---"},frequencyToNote:function(a){return Math.round(12*(Math.log(a/440)/Math.log(2)))+69},nameToNote:function(a){var d,b,e;if(2===a.length)b=a[0]+" "+
a[1];else if(2<a.length)return-1;b.toUpperCase();a=-1;d=0;for(e=c.length;d<e;d++)if(c[d]===b[0]+b[1]){a=d;break}try{return d=parseInt(b[2],10),12*d+a}catch(j){return-1}},convert:function(a){switch(this._type){case 0:return this.noteToFrequency(a);case 1:return this.noteToName(a);case 2:return this.frequencyToNote(a);case 3:return this.nameToNote(a)}},setType:function(a){this._type=a}};e.Converter.Types={NOTE_TO_FREQUENCY:0,NOTE_TO_NAME:1,FREQUENCY_TO_NOTE:2,NAME_TO_NOTE:3};return e}(jMID||{}),jMID=
function(e){var c=function(d){var b={};b.time=d.readVarInt();var a=d.readInt8(),c=e.EventTypes;if(240==(a&240))switch(a){case c.META:b.type=e.EventTypes.META;var h=d.readInt8(),a=d.readVarInt(),c=e.SubEventTypes,g;for(g in c){var f=c[g];if(h==f){b.subtype=f;switch(f){case c.SEQUENCE_NUMBER:b.number=d.readInt16();break;case c.jMID_CHANNEL_PREFIX:b.channel=d.readInt8();break;case c.SET_TEMPO:b.microsecondsPreBeat=(d.readInt8()<<16)+(d.readInt8()<<8)+d.readInt8();break;case c.SMPTE_OFFSET:h=d.readInt8();
b.frameRate={"0":24,32:25,64:29,96:30}[hourByte&96];b.hour=h&31;b.min=d.readInt8();b.sec=d.readInt8();b.frame=d.readInt8();b.subframe=d.readInt8();break;case c.TIME_SIGNATURE:b.numerator=d.readInt8();b.denominator=Math.pow(2,d.readInt8());b.metronome=d.readInt8();b.thirtyseconds=d.readInt8();break;case c.KEY_SIGNATURE:b.key=d.readInt8(!0);b.scale=d.readInt8();break;case c.TEXT:case c.COPYRIGHT_NOTICE:case c.TRACK_NAME:case c.INSTRUMENT_NAME:case c.LYRICS:case c.MARKER:case c.CUE_POINT:b.text=d.read(a);
break;case c.END_OF_TRACK:break;default:b.data=d.read(a)}break}}break;case c.SYSEX:b.type=e.EventTypes.SYSEX;h=d.readVarInt();b.data=d.read(h);break;case c.DIVIDED_SYSEX:event.type=e.EventTypes.DIVIDED_SYSEX;d=stream.readVarInt();event.data=stream.read(d);break;default:throw Error("Unrecognized event");}else for(h in f=a,a=e.SubEventTypes,0==(f&128)?(g=f,f=this._lastEventType):(g=d.readInt8(),this._lastEventType=f),c=f>>4,b.channel=f&15,b.type="channel",a)if(f=a[h],c==f)switch(b.subtype=f,f){case a.NOTE_OFF:b.noteNumber=
g;b.velocity=d.readInt8();break;case a.NOTE_ON:b.noteNumber=g;b.velocity=d.readInt8();0==b.velocity&&(b.subtype=a.NOTE_OFF);break;case a.NOTE_AFTER_TOUCH:b.noteNumber=g;b.amount=d.readInt8();break;case a.CONTROLLER:b.controllerType=g;b.value=d.readInt8();break;case a.PROGRAM_CHANGE:b.programNumber=g;break;case a.CHANNEL_AFTER_TOUCH:b.amount=g;break;case a.PITCH_BEND:b.value=g+(d.readInt8()<<7)}return b},a=function(){var a=this.stream.read(4),b=this.stream.readInt32();return{id:a,length:b,data:this.stream.read(b)}};
e.Decoder=function(a){this.stream=a;this.decode()};e.Decoder.prototype={decode:function(){var d=a.call(this),b=new e.Stream(d.data),i=b.readInt16(),d=b.readInt16(),b=b.readInt16();this.tracks=[];this.header={format:i,trackCount:d,ticksPerBeat:b};for(i=0;i<d;i++){this.tracks[i]=[];b=a.call(this);for(b=new e.Stream(b.data);!b.eof();)this.tracks[i].push(c.call(this,b))}}};e.EventTypes={META:255,SYSEX:240,DIVIDED_SYSEX:247};e.SubEventTypes={SEQUENCE_NUMBER:0,TEXT:1,COPYRIGHT_NOTICE:2,TRACK_NAME:3,INSTRUMENT_NAME:4,
LYRICS:5,MARKER:6,CUE_POINT:7,jMID_CHANNEL_PREFIX:32,END_OF_TRACK:47,SET_TEMPO:81,SMPTE_OFFSET:84,TIME_SIGNATURE:88,KEY_SIGNATURE:89,SEQUENCER_SPECIFIC:127,NOTE_OFF:8,NOTE_ON:9,NOTE_AFTER_TOUCH:10,CONTROLLER:11,PROGRAM_CHANGE:12,CHANNEL_AFTER_TOUCH:13,PITCH_BEND:14};return e}(jMID||{}),jMID=function(e){e.Player=function(c,a){this.BPM=120;this.channelCount=16;this.synth=null;for(var d in a)a.hasOwnProperty(d)&&(this[d]=a[d]);this.trackStates=[];this.TPB=c.header.ticksPerBeat;this.data=c;d=0;for(var b=
c.tracks.length;d<b;d++)trackStates[d]={nextEventIndex:0,ticksToNextEvent:c.tracks[d].length?c.tracks[d][0].time:null}};e.Player.prototype={};return e}(jMID||{}),jMID=function(e){e.Stream=function(c){this.index=0;this.string=c};e.Stream.prototype={read:function(c){var a=this.string.substr(this.index,c);this.index+=c;return a},readInt32:function(){var c=this.string,a=this.index,c=(c.charCodeAt(a)<<24)+(c.charCodeAt(a+1)<<16)+(c.charCodeAt(a+2)<<8)+c.charCodeAt(a+3);this.index+=4;return c},readInt16:function(){var c=
this.string,a=this.index,c=(c.charCodeAt(a)<<8)+c.charCodeAt(a+1);this.index+=2;return c},readInt8:function(c){var a=this.string.charCodeAt(this.index);this.index+=1;return c&&127<a?a-256:a},eof:function(){return this.index>=this.string.length},readVarInt:function(){for(var c=0;;){var a=this.readInt8();if(a&128)c+=a&127,c<<=7;else return c+a}}};return e}(jMID||{});
